<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Body</title>
<meta name="theme-color" content="#0b0d12" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
<style>
  :root{
    /* Muscle-inspired palette */
    --fg:#e5e7eb; --muted:#9aa4b2; --card:#ffffffdd;
    --bg1:#0b0d12; --bg2:#0e1320;
    --ink:#0a0b0f;

    --muscle1:#8b1d2c;  /* deep red */
    --muscle2:#c53030;  /* red */
    --muscle3:#e07a7a;  /* warm salmon */
    --muscleHi:#f9c2c2; /* highlight */

    --title-font: "Anton", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    --body-font: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

    --safe-bottom: env(safe-area-inset-bottom, 16px);
    --safe-top: env(safe-area-inset-top, 16px);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:var(--body-font); color:#fff;
    background:
      radial-gradient(1200px 800px at 15% 20%, color-mix(in oklab, var(--muscle2) 28%, transparent), transparent 60%),
      radial-gradient(1000px 700px at 85% 30%, color-mix(in oklab, var(--muscle3) 28%, transparent), transparent 60%),
      linear-gradient(120deg, var(--bg1), var(--bg2) 50%, var(--bg1));
    overflow:auto; /* no animations */
  }

  .nav{position:fixed;left:16px;top:16px;display:flex;gap:10px;flex-wrap:wrap;z-index:5}
  .pill{display:inline-block;padding:8px 12px;border-radius:999px;background:#ffffffdd;color:#0a0b0f;font-weight:800;text-decoration:none}

  /* XP strip (read-only) */
  .xpWrap{position:fixed; right:16px; top:16px; display:flex; align-items:center; gap:12px; max-width:min(520px, 70vw); z-index:5}
  .xp-badge{background:#ffffffdd; color:#0a0b0f; border-radius:12px; padding:6px 10px; font-size:13px; font-weight:800; box-shadow:0 8px 18px rgba(0,0,0,.15)}
  .xp-bar{ flex:1; height:10px; border-radius:999px; background:rgba(255,255,255,.22); overflow:hidden; position:relative; box-shadow:inset 0 2px 6px rgba(0,0,0,.25)}
  .xp-fill{ position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg, var(--muscle2), var(--muscle3)); }
  .xp-meta{ position:fixed; right:16px; top:50px; font-size:12px; color:#cbd5e1; opacity:.9; z-index:5 }

  /* Page */
  .wrap{
    min-height:100dvh;
    display:grid; place-items:center;
    padding:calc(60px + var(--safe-top)) 18px calc(120px + var(--safe-bottom));
  }
  .title{
    margin:0;
    font-family:var(--title-font);
    font-size:clamp(48px, 12vw, 112px);
    line-height:0.95;
    text-align:center;
    letter-spacing:1px;
    background: linear-gradient(180deg, var(--muscleHi), #fff 30%, var(--muscle3) 65%, var(--muscle2) 100%);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    border-bottom: 6px solid color-mix(in oklab, var(--muscle2) 60%, transparent);
    padding-bottom:10px;
    text-shadow:
      0 2px 0 rgba(0,0,0,.35),
      0 8px 24px rgba(139,29,44,.45);
  }
  .subtitle{
    margin:14px 0 0; text-align:center; max-width:900px; color:#e2e8f0; font-weight:600;
  }

  /* Exercises CTA */
  .cta{
    position:fixed; left:50%; transform:translateX(-50%);
    bottom:calc(18px + var(--safe-bottom)); z-index:4;
    background:linear-gradient(90deg, var(--muscle2), var(--muscle3));
    color:var(--ink); border:none; padding:14px 22px; font-weight:900;
    border-radius:16px; box-shadow:0 12px 28px rgba(0,0,0,.35);
    cursor:pointer; letter-spacing:.4px;
    width:min(560px, 92vw);
  }

  /* Drawer */
  .scrim{position:fixed; inset:0; background:rgba(3,6,16,.6); opacity:0; pointer-events:none; z-index:6}
  .scrim.show{opacity:1; pointer-events:auto}
  .drawer{
    position:fixed; inset:auto 0 0 0; height:min(90dvh, 900px);
    background:rgba(15,18,28,.9); backdrop-filter: blur(8px) saturate(1.2);
    border-top:1px solid rgba(255,255,255,.25);
    display:none; z-index:7; box-shadow: 0 -30px 60px rgba(0,0,0,.45);
  }
  .drawer.show{display:block}
  .drawer-head{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.18)
  }
  .drawer-title{font-weight:900; letter-spacing:.3px}
  .closeX{
    background:#ffffff; color:#0a0b0f; border:none; border-radius:10px; font-weight:900; cursor:pointer;
    padding:6px 10px; line-height:1;
  }
  .drawer-body{padding:14px 16px 20px; overflow:auto; height:calc(100% - 56px)}

  /* Tabs + search */
  .lib-top{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin-bottom:12px}
  .seg{display:inline-flex; background:rgba(255,255,255,.14); border-radius:12px; padding:4px;}
  .seg button{border:none; background:transparent; color:#e2e8f0; padding:10px 14px; border-radius:10px; font-weight:900; cursor:pointer}
  .seg button.active{background:#ffffff; color:#0a0b0f}
  .search{flex:1; min-width:220px; display:flex; align-items:center; gap:8px; background:rgba(255,255,255,.14); border-radius:12px; padding:8px 12px}
  .search input{flex:1; background:transparent; border:none; color:#fff; outline:none; font-weight:700; font-size:14px}

  /* Cards grid */
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:14px}
  @media (max-width:380px){ .grid{grid-template-columns:1fr} }
  .card{background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.18); border-radius:16px; padding:12px; display:flex; flex-direction:column; gap:10px;}
  .card h3{margin:0; font-size:18px; letter-spacing:.2px}
  .meta{font-size:12px; color:#cbd5e1; display:flex; flex-wrap:wrap; gap:8px}
  .badge{background:#ffffff; color:#0a0b0f; border-radius:999px; padding:2px 8px; font-weight:900; font-size:11px}
  details{border-top:1px dashed rgba(255,255,255,.2); padding-top:8px}
  details > summary{cursor:pointer; font-weight:800; list-style:none}
  details > summary::-webkit-details-marker{display:none}
  ul{margin:.4em 0 .2em 1.1em}
  li{margin:.2em 0}

  /* Games */
  .gamesPane{display:none; gap:14px}
  .gameCard{background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.18); border-radius:16px; padding:12px; display:flex; flex-direction:column; gap:10px;}
  .gameCard h3{margin:0; font-size:18px}
  .controlsRow{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
  .btn{border:none; background:#ffffff; color:#0a0b0f; padding:8px 10px; border-radius:10px; font-weight:900; cursor:pointer}
  .stat{font-weight:800; color:#e2e8f0; margin-left:auto}
  .arena{position:relative; width:100%; height:360px; background:#0b1220; border:1px solid rgba(255,255,255,.2); border-radius:12px; touch-action:none; user-select:none}
  @media (min-width:900px){ .gamesPane{display:grid; grid-template-columns:1fr 1fr} .arena{height:420px} }
  .target{position:absolute; width:54px; height:54px; border-radius:999px; background:linear-gradient(180deg, var(--muscle3), var(--muscle2)); border:2px solid #fff; display:grid; place-items:center; font-weight:900; color:#0a0b0f}
  .dirHint{display:inline-flex; align-items:center; gap:8px; font-weight:800; color:#e2e8f0}
  .arrow{display:inline-block; padding:2px 8px; border-radius:8px; background:#ffffff; color:#0a0b0f; font-weight:900}
  .swipeNote{font-size:12px; color:#cbd5e1}
  .flashBad{background:#4a0a14 !important;} /* quick error flash (we toggle it briefly) */
</style>
</head>
<body>
  <!-- Nav -->
  <div class="nav">
    <a class="pill" href="index.html">← Home</a>
    <a class="pill" href="heart.html">Heart</a>
    <a class="pill" href="mind.html">Mind</a>
    <a class="pill" href="soul.html">Soul</a>
  </div>

  <!-- Level/XP (display only) -->
  <div class="xpWrap">
    <div class="xp-badge" id="xpBadge">Level 0</div>
    <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
  </div>
  <div class="xp-meta" id="xpMeta">0 / 200 XP</div>

  <!-- Page -->
  <main class="wrap">
    <header style="text-align:center">
      <h1 class="title">BODY</h1>
      <p class="subtitle">Organized training choices—clear technique, real-world sets & reps. Tabs: <strong>At Home</strong>, <strong>At the Gym</strong>, <strong>Lazy Gains</strong>, and <strong>Games</strong>.</p>
    </header>
  </main>

  <!-- Exercises CTA -->
  <button class="cta" id="openExercises" aria-haspopup="dialog" aria-controls="drawer">Exercises</button>

  <!-- Drawer + scrim -->
  <div class="scrim" id="scrim" aria-hidden="true"></div>
  <section class="drawer" id="drawer" role="dialog" aria-label="Exercises Library" aria-modal="true" aria-hidden="true">
    <header class="drawer-head">
      <div class="drawer-title">Exercises</div>
      <button class="closeX" id="closeDrawer" aria-label="Close exercises">×</button>
    </header>
    <div class="drawer-body">
      <div class="lib-top">
        <div class="seg" role="tablist" aria-label="Sections">
          <button class="active" id="tabHome" role="tab" aria-selected="true">At Home</button>
          <button id="tabGym" role="tab" aria-selected="false">At the Gym</button>
          <button id="tabLazy" role="tab" aria-selected="false">Lazy Gains</button>
          <button id="tabGames" role="tab" aria-selected="false">Games</button>
        </div>
        <label class="search" aria-label="Search exercises">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.2-4.2M10.8 18a7.2 7.2 0 1 1 0-14.4 7.2 7.2 0 0 1 0 14.4Z" stroke="white" stroke-opacity=".8" stroke-width="2" stroke-linecap="round"/></svg>
          <input id="q" placeholder="Search movement, muscle, equipment…" />
        </label>
      </div>

      <!-- Library cards -->
      <div class="grid" id="cards" aria-live="polite"></div>

      <!-- Games -->
      <div class="gamesPane" id="gamesPane" aria-live="polite">
        <!-- Tap Sprint -->
        <section class="gameCard">
          <h3>Tap Sprint</h3>
          <div class="controlsRow">
            <button class="btn" id="tapStart">Start</button>
            <button class="btn" id="tapStop">Stop</button>
            <button class="btn" id="tapReset">Reset</button>
            <span class="stat" id="tapStat">Score: 0</span>
          </div>
          <div class="arena" id="tapArena" aria-label="Tap arena"></div>
          <p class="swipeNote">Tap all circles. New circles only appear after you clear the current wave. Max 5 per wave.</p>
        </section>

        <!-- Reflex Sprint (swipe/tap) -->
        <section class="gameCard">
          <h3>Reflex Sprint</h3>
          <div class="controlsRow">
            <button class="btn" id="reflexStart">Start</button>
            <button class="btn" id="reflexStop">Stop</button>
            <button class="btn" id="reflexReset">Reset</button>
            <span class="stat" id="reflexStat">Count: 0</span>
          </div>
          <div class="controlsRow">
            <span class="dirHint">Do this now → <span class="arrow" id="reflexAction">—</span></span>
          </div>
          <div class="arena" id="reflexArena" aria-label="Reflex arena"></div>
          <p class="swipeNote">Respond fast: TAP or SWIPE ← → ↑ ↓. Wrong move resets your Count to 0.</p>
        </section>
      </div>
    </div>
  </section>

<script>
/* ===== XP (read from localStorage; no earning here) ===== */
function loadXP(){ try{ return JSON.parse(localStorage.getItem("xp_v1")) || {level:0, xp:0}; } catch { return {level:0, xp:0}; } }
const MAX_LEVEL = 100;
function xpForNext(level){ if(level>=MAX_LEVEL) return Infinity; const base=200, growth=1.12; return Math.round(base * Math.pow(growth, level)); }
function updateXPUI(){
  const xpState = loadXP();
  const need = xpForNext(xpState.level);
  document.getElementById('xpBadge').textContent = `Level ${xpState.level}`;
  document.getElementById('xpFill').style.width =
    (xpState.level>=MAX_LEVEL ? 100 : Math.round(100 * (xpState.xp / need))) + "%";
  document.getElementById('xpMeta').textContent =
    xpState.level>=MAX_LEVEL ? `MAX • Level ${MAX_LEVEL}` : `${xpState.xp} / ${need} XP`;
}
updateXPUI();
document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) updateXPUI(); });

/* ===== Library Data (no graphics) ===== */
const LIBRARIES = {
  home: [
    { id:"pushup", name:"Push-Up", muscles:["Chest","Triceps","Anterior delts","Core"], level:"Beginner+", equipment:"Bodyweight", setsReps:"3–4 × 6–12",
      steps:["Hands under shoulders, body in a straight line, glutes/abs tight.","Lower with elbows ~45° from torso until chest is close to floor.","Press through palms, keeping ribs tucked and neck neutral."],
      cues:["Squeeze glutes","Screw palms into floor","Exhale as you press"],
      mistakes:["Elbows flaring wide","Sagging hips","Head jutting forward"] },
    { id:"squat-bw", name:"Bodyweight Squat", muscles:["Quads","Glutes","Adductors","Core"], level:"Beginner", equipment:"Bodyweight", setsReps:"3–4 × 10–15",
      steps:["Feet shoulder-width, toes slightly out.","Sit hips back/down, knees track over toes, chest tall.","Descend to comfortable depth; drive mid-foot to stand."],
      cues:["Knees track with toes","Weight mid-foot","Brace before each rep"],
      mistakes:["Heels lifting","Knees caving in","Losing brace at bottom"] },
    { id:"glute-bridge", name:"Glute Bridge", muscles:["Glutes","Hamstrings","Core"], level:"Beginner", equipment:"Bodyweight", setsReps:"3 × 12–15 (1–2s squeeze top)",
      steps:["Heels close to glutes, ribs down, pelvis neutral.","Drive through heels to lift hips; squeeze glutes at top.","Lower under control; avoid over-arching lower back."],
      cues:["Exhale into brace","Posterior pelvic tilt","Big toe/heel contact"],
      mistakes:["Flaring ribs","Pushing off toes","Hyperextending at top"] },
    { id:"plank", name:"Forearm Plank", muscles:["Core","Glutes","Shoulders"], level:"Beginner", equipment:"Bodyweight", setsReps:"3 × 20–40s",
      steps:["Elbows under shoulders, forearms parallel.","Squeeze glutes, slight pelvic tuck, ribs down.","Hold straight line from ears to ankles; breathe."],
      cues:["Crush the floor","Long spine","Soft nasal inhale"],
      mistakes:["Butt too high/low","Shoulder shrugging","Holding breath"] }
  ],
  gym: [
    { id:"bb-squat", name:"Barbell Back Squat", muscles:["Quads","Glutes","Adductors","Core"], level:"Intermediate", equipment:"Barbell/Rack", setsReps:"3–5 × 3–8",
      steps:["Bar set just below traps; hands even, elbows under bar.","Unrack, step back, feet shoulder-width, brace hard.","Sit back/down keeping knees tracking; stand through mid-foot."],
      cues:["Big breath/brace","Knees out","Chest over mid-foot"],
      mistakes:["Soft brace","Heels popping","Knees collapsing in"] },
    { id:"bench", name:"Barbell Bench Press", muscles:["Chest","Triceps","Anterior delts"], level:"Intermediate", equipment:"Barbell/Bench", setsReps:"3–5 × 4–8",
      steps:["Eyes under bar; upper-back set; feet planted.","Lower to lower-sternum with forearms vertical.","Press back/up; keep shoulder blades retracted."],
      cues:["Row it down","Press the floor","No bounce"],
      mistakes:["Elbow flare","Loose upper back","Bouncing off chest"] },
    { id:"latpd", name:"Lat Pulldown", muscles:["Lats","Biceps","Mid-back"], level:"Beginner+", equipment:"Pulldown machine", setsReps:"3–4 × 8–12",
      steps:["Set thigh pad; grasp bar slightly wider than shoulders.","Pull elbows to ribs/chest up; pause near collarbone.","Control the return to full stretch without shrugging."],
      cues:["Elbows in pockets","Chest tall","Lead with lats"],
      mistakes:["Leaning way back","Half reps","Shrugging neck"] },
    { id:"cable-row", name:"Seated Cable Row", muscles:["Lats","Rhomboids","Rear delts","Biceps"], level:"Beginner", equipment:"Cable/Row", setsReps:"3–4 × 8–12",
      steps:["Neutral spine, chest tall, shoulders down/back.","Pull handle to lower ribs; pause; return with control.","Keep wrists neutral; avoid excessive lean."],
      cues:["Pull with elbows","Squeeze shoulder blades","Stay tall"],
      mistakes:["Shrugging","Rounding lower back","Using momentum"] }
  ],
  lazy: [
    { id:"toe-curls", name:"Toe Curls (Seated/Standing)", muscles:["Intrinsic foot","Calves"], level:"Super easy", equipment:"None / Towel", setsReps:"2–3 × 10–20 each foot",
      steps:["Barefoot if possible. Spread toes, then curl to scrunch a towel or the floor.","Hold 1s, then release and actively spread toes again.","Keep ankle neutral; avoid cramping by easing range."],
      cues:["Slow squeeze","Full release","Breathe easy"], mistakes:["Cramping from rushing","Ankle rolling in/out"] },
    { id:"neck-rolls", name:"Neck Rolls (Gentle)", muscles:["Neck flexors/extensors"], level:"Super easy", equipment:"None", setsReps:"1–2 × 3 slow circles each way",
      steps:["Sit/stand tall. Draw small comfortable circles with nose.","Go slow, pain-free range only.","Switch directions; keep shoulders relaxed."],
      cues:["Tiny circles","Relax jaw","Easy breath"], mistakes:["Forcing end-range","Shrugging shoulders"] },
    { id:"shrugs", name:"Shoulder Shrugs", muscles:["Upper traps"], level:"Super easy", equipment:"None", setsReps:"2–3 × 10–15",
      steps:["Stand tall. Lift shoulders toward ears without craning neck.","Pause 1s at top; lower under control.","Option: add light objects for load."],
      cues:["Long neck","Even lift","Smooth lower"], mistakes:["Chin jutting","Rolling shoulders excessively"] },
    { id:"breathing", name:"Deep Breathing (Box/4-7-8)", muscles:["Diaphragm","Parasympathetic"], level:"Super easy", equipment:"None", setsReps:"3–5 cycles",
      steps:["Nasal inhale 4s → hold 4s → exhale 4s → hold 4s (box).","Or 4-7-8: inhale 4s → hold 7s → exhale 8s.","Keep ribs down, shoulders relaxed, slow & quiet."],
      cues:["Belly expands 360°","Soft jaw","Long exhale"], mistakes:["Chest-only breathing","Rushing counts"] },
    { id:"eye-moves", name:"Eye Movement Drills", muscles:["Extraocular muscles"], level:"Super easy", equipment:"None", setsReps:"2–3 × 20–30s",
      steps:["Keep head still; move eyes: left↔right, up↕down, diagonals.","Finish with smooth circles both ways.","Blink normally; stop if dizzy."],
      cues:["Slow tracks","Relax face","Blink and breathe"], mistakes:["Straining at extremes","Holding breath"] }
  ]
};

/* ===== Drawer controls ===== */
const drawer = document.getElementById('drawer');
const scrim = document.getElementById('scrim');
const openBtn = document.getElementById('openExercises');
const closeBtn = document.getElementById('closeDrawer');
const q = document.getElementById('q');
const tabHome = document.getElementById('tabHome');
const tabGym = document.getElementById('tabGym');
const tabLazy = document.getElementById('tabLazy');
const tabGames = document.getElementById('tabGames');
const cards = document.getElementById('cards');
const gamesPane = document.getElementById('gamesPane');

let currentTab = 'home'; // 'home' | 'gym' | 'lazy' | 'games'
let searchTerm = '';

function openDrawer(){
  drawer.classList.add('show'); scrim.classList.add('show');
  drawer.setAttribute('aria-hidden','false'); scrim.setAttribute('aria-hidden','false');
  closeBtn.focus();
}
function closeDrawer(){
  drawer.classList.remove('show'); scrim.classList.remove('show');
  drawer.setAttribute('aria-hidden','true'); scrim.setAttribute('aria-hidden','true');
  openBtn.focus();
}
openBtn.addEventListener('click', openDrawer);
closeBtn.addEventListener('click', closeDrawer);
scrim.addEventListener('click', closeDrawer);
addEventListener('keydown', e=>{ if(e.key==='Escape' && drawer.classList.contains('show')) closeDrawer(); });

function setTab(tab){
  currentTab = tab;
  tabHome.classList.toggle('active', tab==='home');
  tabGym.classList.toggle('active', tab==='gym');
  tabLazy.classList.toggle('active', tab==='lazy');
  tabGames.classList.toggle('active', tab==='games');
  tabHome.setAttribute('aria-selected', tab==='home');
  tabGym.setAttribute('aria-selected', tab==='gym');
  tabLazy.setAttribute('aria-selected', tab==='lazy');
  tabGames.setAttribute('aria-selected', tab==='games');

  if(tab==='games'){
    cards.style.display='none';
    gamesPane.style.display='grid';
  } else {
    gamesPane.style.display='none';
    cards.style.display='grid';
    const list = tab==='home' ? LIBRARIES.home : tab==='gym' ? LIBRARIES.gym : LIBRARIES.lazy;
    renderList(list);
  }
}
tabHome.addEventListener('click', ()=>setTab('home'));
tabGym.addEventListener('click', ()=>setTab('gym'));
tabLazy.addEventListener('click', ()=>setTab('lazy'));
tabGames.addEventListener('click', ()=>setTab('games'));

q.addEventListener('input', ()=>{
  searchTerm = q.value.toLowerCase();
  if(currentTab==='games') return;
  const list = currentTab==='home' ? LIBRARIES.home : currentTab==='gym' ? LIBRARIES.gym : LIBRARIES.lazy;
  renderList(list);
});

function renderList(list){
  const data = !searchTerm ? list : list.filter(item=>{
    const hay = (item.name+' '+item.muscles.join(' ')+' '+(item.equipment||'')+' '+(item.level||'')).toLowerCase();
    return hay.includes(searchTerm);
  });
  cards.innerHTML = data.map(renderCard).join('');
}

function renderCard(ex){
  return `
    <article class="card" data-id="${ex.id}">
      <h3>${ex.name}</h3>
      <div class="meta">
        ${ex.level?`<span class="badge">${ex.level}</span>`:''}
        ${ex.equipment?`<span class="badge">${ex.equipment}</span>`:''}
        ${ex.setsReps?`<span class="badge">${ex.setsReps}</span>`:''}
        ${ex.muscles?.length? ex.muscles.slice(0,3).map(m=>`<span class="badge">${m}</span>`).join('') : ''}
      </div>
      <details>
        <summary>Technique steps</summary>
        <ul>${ex.steps.map(s=>`<li>${s}</li>`).join('')}</ul>
      </details>
      ${ex.cues?`<details><summary>Coaching cues</summary><ul>${ex.cues.map(c=>`<li>${c}</li>`).join('')}</ul></details>`:''}
      ${ex.mistakes?`<details><summary>Common mistakes</summary><ul>${ex.mistakes.map(m=>`<li>${m}</li>`).join('')}</ul></details>`:''}
    </article>
  `;
}

/* ========= Tap Sprint (wave-based, “Score” only) ========= */
const tapArena = document.getElementById('tapArena');
const tapStart = document.getElementById('tapStart');
const tapStop  = document.getElementById('tapStop');
const tapReset = document.getElementById('tapReset');
const tapStat  = document.getElementById('tapStat');

let tapRunning = false;
let tapScore = 0;
let tapTargets = new Map(); // id -> element
let tapNextId = 1;

function tapUpdateStat(){ tapStat.textContent = `Score: ${tapScore}`; }

function tapWaveSize(){
  // increase with score; caps at 5
  return Math.min(5, Math.floor(tapScore / 8) + 1);
}

function tapSpawnWave(){
  if(!tapRunning) return;
  if(tapTargets.size > 0) return; // only after all cleared
  const n = tapWaveSize();
  for(let i=0;i<n;i++) tapSpawnOne();
}

function tapSpawnOne(){
  const id = tapNextId++;
  const el = document.createElement('button');
  el.type='button';
  el.className='target';
  el.textContent='•';
  el.setAttribute('aria-label','tap target');

  // random position within arena
  const pad = 60;
  const rect = tapArena.getBoundingClientRect();
  const x = Math.floor(Math.random() * Math.max(1, rect.width  - pad));
  const y = Math.floor(Math.random() * Math.max(1, rect.height - pad));
  el.style.left = `${x}px`; el.style.top = `${y}px`;
  el.dataset.id = String(id);

  const hit = (e)=>{
    e.preventDefault();
    e.stopPropagation();
    if(!tapTargets.has(id)) return;
    tapScore += 1;
    tapUpdateStat();
    const node = tapTargets.get(id);
    tapTargets.delete(id);
    node?.remove();
    // when all cleared, spawn the next wave (fast)
    if(tapRunning && tapTargets.size === 0){
      setTimeout(tapSpawnWave, 0);
    }
  };
  // multi-input friendly
  el.addEventListener('pointerdown', hit, {passive:false});
  el.addEventListener('click', hit, {passive:false});

  tapArena.appendChild(el);
  tapTargets.set(id, el);
}

function tapStartGame(){
  if(tapRunning) return;
  tapRunning = true;
  tapSpawnWave();
}
function tapStopGame(){ tapRunning = false; }
function tapResetGame(){
  tapStopGame();
  tapScore = 0; tapUpdateStat();
  tapTargets.forEach(n=>n.remove()); tapTargets.clear();
}
tapStart.addEventListener('click', tapStartGame);
tapStop .addEventListener('click', tapStopGame);
tapReset.addEventListener('click', tapResetGame);
tapUpdateStat();

/* ========= Reflex Sprint (tap or swipe; wrong => reset) ========= */
const reflexArena = document.getElementById('reflexArena');
const reflexStart = document.getElementById('reflexStart');
const reflexStop  = document.getElementById('reflexStop');
const reflexReset = document.getElementById('reflexReset');
const reflexStat  = document.getElementById('reflexStat');
const reflexActionEl = document.getElementById('reflexAction');

let reflexRunning = false;
let reflexCount = 0;
let currentAction = null; // 'tap','left','right','up','down'

function setActionText(a){
  reflexActionEl.textContent = a === 'tap' ? 'TAP' :
    a === 'left' ? '←' :
    a === 'right' ? '→' :
    a === 'up' ? '↑' : '↓';
}

function nextAction(){
  const actions = ['tap','left','right','up','down'];
  currentAction = actions[Math.floor(Math.random()*actions.length)];
  setActionText(currentAction);
}

function reflexUpdate(){ reflexStat.textContent = `Count: ${reflexCount}`; }

function flashBad(){
  const old = reflexArena.style.backgroundColor;
  reflexArena.classList.add('flashBad');
  setTimeout(()=>{ reflexArena.classList.remove('flashBad'); }, 150);
}

function failReset(){
  reflexCount = 0;
  reflexUpdate();
  flashBad();
  nextAction();
}

function success(){
  reflexCount += 1;
  reflexUpdate();
  nextAction();
}

function reflexStartGame(){
  if(reflexRunning) return;
  reflexRunning = true;
  reflexCount = 0; reflexUpdate();
  nextAction();
}
function reflexStopGame(){ reflexRunning = false; }
function reflexResetGame(){
  reflexStopGame();
  reflexCount = 0; reflexUpdate();
  currentAction = null; reflexActionEl.textContent = '—';
}
reflexStart.addEventListener('click', reflexStartGame);
reflexStop .addEventListener('click', reflexStopGame);
reflexReset.addEventListener('click', reflexResetGame);

/* Gesture detection for Reflex Sprint */
let sx=0, sy=0, st=0, tracking=false;
const MAX_TIME = 600;  // fast
const MIN_DIST = 40;   // px threshold for swipe
const TAP_MAX_DIST = 12; // px for tap
const TAP_MAX_TIME = 300; // ms for tap

function onReflexDown(e){
  if(!reflexRunning) return;
  tracking = true;
  sx = e.clientX; sy = e.clientY; st = performance.now();
}
function onReflexUp(e){
  if(!reflexRunning || !tracking) return;
  tracking = false;
  const dx = e.clientX - sx;
  const dy = e.clientY - sy;
  const dt = performance.now() - st;

  // Determine input
  let input = null;
  if(dt <= TAP_MAX_TIME && Math.hypot(dx,dy) <= TAP_MAX_DIST){
    input = 'tap';
  } else if(dt <= MAX_TIME){
    if(Math.abs(dx) > Math.abs(dy) && Math.abs(dx) >= MIN_DIST){
      input = dx > 0 ? 'right' : 'left';
    } else if(Math.abs(dy) >= MIN_DIST){
      input = dy > 0 ? 'down' : 'up';
    }
  }

  if(!input){
    // too slow or too short: consider it a fail to keep it intense
    failReset();
    return;
    }

  if(input === currentAction) success(); else failReset();
}

['pointerdown','mousedown','touchstart'].forEach(type=>{
  reflexArena.addEventListener(type, e=>{
    // ignore synthetic mousedown if pointerdown exists
    if(e.pointerType && type==='mousedown') return;
    onReflexDown(e);
  }, {passive:true});
});
['pointerup','mouseup','touchend','pointercancel'].forEach(type=>{
  reflexArena.addEventListener(type, e=>{
    onReflexUp(e);
  }, {passive:true});
});

/* ===== Init ===== */
function initialRender(){
  setTab('home');
}
initialRender();
</script>
</body>
</html>





