<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Train Now • Body</title>
<meta name="theme-color" content="#0b0d12" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
<style>
  :root{
    --fg:#eef2ff; --muted:#b4c1d9; --card:#ffffffee;
    --bg1:#0b0d12; --bg2:#111a2e; --bg3:#15233b;
    --ink:#0a0b0f;
    --muscle2:#c53030; --muscle3:#e07a7a; --muscleHi:#f9c2c2;
    --play1:#22c55e; --play2:#06b6d4; --play3:#f59e0b; --play4:#a78bfa;
    --title-font:"Anton", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    --body-font: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

    --safe-top: env(safe-area-inset-top, 16px);
    --safe-bottom: env(safe-area-inset-bottom, 16px);
    --page-pad: clamp(12px, 3vw, 18px);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:var(--body-font); color:#fff;
    background:
      radial-gradient(1200px 800px at 15% 20%, color-mix(in oklab, var(--play2) 35%, transparent), transparent 60%),
      radial-gradient(1000px 700px at 85% 30%, color-mix(in oklab, var(--play1) 28%, transparent), transparent 60%),
      radial-gradient(900px 700px at 40% 90%, color-mix(in oklab, var(--play4) 22%, transparent), transparent 60%),
      linear-gradient(120deg, var(--bg1), var(--bg2) 50%, var(--bg3));
    overflow:auto;
    -webkit-tap-highlight-color: transparent;
  }

  /* Back to Exercises (mobile-friendly pill) */
  .nav{
    position:fixed; left:var(--page-pad); top:var(--safe-top); z-index:10;
  }
  .pill{
    display:inline-block; padding:10px 14px; border-radius:999px;
    background:#ffffffdd; color:#0a0b0f; font-weight:800; text-decoration:none;
    box-shadow:0 8px 18px rgba(0,0,0,.2);
  }

  /* Header */
  .wrap{
    min-height:100dvh; display:grid; place-items:center;
    padding:calc(70px + var(--safe-top)) var(--page-pad) calc(14px + var(--safe-bottom));
  }
  .title{
    margin:0; font-family:var(--title-font);
    font-size:clamp(40px, 10vw, 96px); line-height:0.95; text-align:center; letter-spacing:1px;
    background: linear-gradient(180deg, var(--muscleHi), #fff 30%, var(--muscle3) 65%, var(--muscle2) 100%);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow:0 2px 0 rgba(0,0,0,.35), 0 8px 24px rgba(139,29,44,.45);
  }

  /* Games hub + panes (unchanged behavior, but more mobile-friendly spacing) */
  .gamesHub{
    display:grid; grid-template-columns:1fr 1fr; gap:12px;
    max-width:min(1100px, 96vw); margin:12px auto;
    padding:0 var(--page-pad);
  }
  @media (max-width:760px){ .gamesHub{grid-template-columns:1fr} }
  .gamePick{
    background:linear-gradient(90deg, var(--play3), var(--play4));
    color:#0a0b0f; border:none; border-radius:18px; padding:16px;
    font-weight:900; cursor:pointer; touch-action:manipulation;
    box-shadow:0 12px 24px rgba(0,0,0,.35);
    font-size:clamp(14px, 3.5vw, 16px);
  }

  .gamePane{display:none; max-width:min(1100px, 96vw); margin:0 auto 18px; padding:0 var(--page-pad)}
  .gamePane.active{display:block}
  .gameCard{
    background:rgba(255,255,255,.10); border:1.5px solid rgba(255,255,255,.22);
    border-radius:18px; padding:12px; display:flex; flex-direction:column; gap:10px;
    box-shadow:0 16px 32px rgba(0,0,0,.35);
  }
  .controlsRow{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
  .btn{
    border:none; background:#ffffff; color:#0a0b0f; padding:12px 14px;
    border-radius:12px; font-weight:900; cursor:pointer; touch-action:manipulation;
    font-size:clamp(13px, 3.8vw, 14px);
  }
  .stat{font-weight:800; color:#e2e8f0; margin-left:auto; font-size:clamp(13px, 3.8vw, 14px)}

  /* Arena: responsive height for phones; keep same behavior */
  .arena{
    position:relative; width:100%;
    height:clamp(320px, 52vh, 480px);
    background:#0b1220; border:2px solid rgba(255,255,255,.25); border-radius:14px;
    touch-action:none; user-select:none;
  }
  .target{position:absolute; width:54px; height:54px; border-radius:999px; background:linear-gradient(180deg, var(--muscle3), var(--muscle2)); border:2px solid #fff; display:grid; place-items:center; font-weight:900; color:#0a0b0f}
  .dirHint{display:inline-flex; align-items:center; gap:8px; font-weight:800; color:#e2e8f0; font-size:clamp(13px, 3.8vw, 14px)}
  .arrow{display:inline-block; padding:2px 8px; border-radius:8px; background:#ffffff; color:#0a0b0f; font-weight:900}
  .swipeNote{font-size:12px; color:#cbd5e1}
  .flashBad{background:#4a0a14 !important;}
</style>
</head>
<body>
  <!-- Back to Exercises -->
  <div class="nav">
    <a class="pill" href="exercises.html">← Back to Exercises</a>
  </div>

  <!-- Header -->
  <main class="wrap">
    <header style="text-align:center">
      <h1 class="title">Train Now</h1>
    </header>
  </main>

  <!-- Games hub (same functionality) -->
  <div id="gamesHub" class="gamesHub" aria-live="polite">
    <button class="gamePick" id="pickTap">▶ Tap Sprint</button>
    <button class="gamePick" id="pickReflex">▶ Reflex Sprint</button>
  </div>

  <!-- Tap game -->
  <div id="tapPane" class="gamePane">
    <section class="gameCard">
      <div class="controlsRow">
        <button class="btn" id="tapBack">← Back to Games</button>
        <button class="btn" id="tapStart">Start</button>
        <button class="btn" id="tapStop">Stop</button>
        <button class="btn" id="tapReset">Reset</button>
        <span class="stat" id="tapStat">Score: 0</span>
      </div>
      <div class="arena" id="tapArena" aria-label="Tap arena"></div>
      <p class="swipeNote">Tap all circles. New circles only appear after you clear the current wave. Max 5 per wave.</p>
    </section>
  </div>

  <!-- Reflex game -->
  <div id="reflexPane" class="gamePane">
    <section class="gameCard">
      <div class="controlsRow">
        <button class="btn" id="reflexBack">← Back to Games</button>
        <button class="btn" id="reflexStart">Start</button>
        <button class="btn" id="reflexStop">Stop</button>
        <button class="btn" id="reflexReset">Reset</button>
        <span class="stat" id="reflexStat">Score: 0</span>
      </div>
      <div class="controlsRow">
        <span class="dirHint">Do this now → <span class="arrow" id="reflexAction">—</span></span>
      </div>
      <div class="arena" id="reflexArena" aria-label="Reflex arena"></div>
      <p class="swipeNote">Respond fast: TAP or SWIPE ← → ↑ ↓. Wrong move resets your Score to 0.</p>
    </section>
  </div>

<script>
/* ===== Mini SFX engine (unchanged) ===== */
const SFX = (()=>{
  let ctx = null;
  const ensure = ()=>{ if(!ctx){ ctx = new (window.AudioContext || window.webkitAudioContext)(); } if(ctx.state==='suspended'){ ctx.resume(); } return ctx; };
  const env = (node, t, a=0.005, d=0.12, s=0.0, r=0.15, peak=0.9)=>{
    const g = node.gain || node;
    const now = t;
    g.cancelScheduledValues(now);
    g.setValueAtTime(0.0001, now);
    g.linearRampToValueAtTime(peak, now+a);
    g.linearRampToValueAtTime(s, now+a+d);
    g.exponentialRampToValueAtTime(0.0001, Math.max(now+a+d+r, now+a+d+0.15));
  };
  const noiseBuffer = ()=>{
    const c = ensure();
    const len = c.sampleRate * 0.35;
    const buf = c.createBuffer(1, len, c.sampleRate);
    const d = buf.getChannelData(0);
    for(let i=0;i<len;i++) d[i] = (Math.random()*2-1) * (1 - i/len);
    return buf;
  };
  const cachedNoise = noiseBuffer();
  function whoosh(){ const c=ensure(); const t=c.currentTime; const n=c.createBufferSource(); n.buffer=cachedNoise; const g=c.createGain(); const bp=c.createBiquadFilter(); bp.type='highpass'; bp.frequency.value=400; n.connect(bp); bp.connect(g); g.connect(c.destination); env(g,t,0.005,0.25,0.0008,0.25,0.7); n.playbackRate.value=1.2; n.start(t); }
  function ignite(){ const c=ensure(); const t=c.currentTime; const o=c.createOscillator(); o.type='square'; o.frequency.setValueAtTime(280,t); const og=c.createGain(); env(og,t,0.001,0.05,0.0,0.05,0.8); const n=c.createBufferSource(); n.buffer=cachedNoise; const ng=c.createGain(); env(ng,t,0.001,0.08,0.0,0.06,0.6); const hp=c.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1200; o.connect(og).connect(c.destination); n.connect(hp).connect(ng).connect(c.destination); o.start(t); o.stop(t+0.15); n.start(t); }
  function boom(){ const c=ensure(); const t=c.currentTime; const o=c.createOscillator(); o.type='triangle'; o.frequency.setValueAtTime(160,t); o.frequency.exponentialRampToValueAtTime(60,t+0.25); const g=c.createGain(); env(g,t,0.002,0.18,0.0008,0.4,0.9); const lp=c.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=600; o.connect(lp).connect(g).connect(c.destination); o.start(t); o.stop(t+0.5); }
  return { whoosh, ignite, boom, ensure };
})();

/* ===== Games hub controls (unchanged) ===== */
const gamesHub = document.getElementById('gamesHub');
const tapPane = document.getElementById('tapPane');
const reflexPane = document.getElementById('reflexPane');
const pickTap = document.getElementById('pickTap');
const pickReflex = document.getElementById('pickReflex');
const tapBack = document.getElementById('tapBack');
const reflexBack = document.getElementById('reflexBack');

function showGamesHub(){
  gamesHub.style.display='grid';
  tapPane.classList.remove('active'); tapPane.style.display='none';
  reflexPane.classList.remove('active'); reflexPane.style.display='none';
  tapStopGame(); reflexStopGame();
}
function showTapGame(){
  gamesHub.style.display='none';
  tapPane.style.display='block'; tapPane.classList.add('active');
  reflexPane.style.display='none'; reflexPane.classList.remove('active');
}
function showReflexGame(){
  gamesHub.style.display='none';
  reflexPane.style.display='block'; reflexPane.classList.add('active');
  tapPane.style.display='none'; tapPane.classList.remove('active');
}
pickTap.addEventListener('click', showTapGame);
pickReflex.addEventListener('click', showReflexGame);
tapBack.addEventListener('click', showGamesHub);
reflexBack.addEventListener('click', showGamesHub);

/* ===== Tap Sprint (unchanged) ===== */
const tapArena = document.getElementById('tapArena');
const tapStart = document.getElementById('tapStart');
const tapStopBtn  = document.getElementById('tapStop');
const tapReset = document.getElementById('tapReset');
const tapStat  = document.getElementById('tapStat');

let tapRunning = false;
let tapScore = 0;
let tapTargets = new Map();
let tapNextId = 1;

function tapUpdateStat(){ tapStat.textContent = `Score: ${tapScore}`; }
function tapWaveSize(){ return Math.min(5, Math.floor(tapScore / 8) + 1); }
function tapSpawnWave(){
  if(!tapRunning) return;
  if(tapTargets.size > 0) return;
  SFX.whoosh();
  const n = tapWaveSize();
  for(let i=0;i<n;i++) tapSpawnOne();
}
function tapSpawnOne(){
  const id = tapNextId++;
  const el = document.createElement('button');
  el.type='button'; el.className='target'; el.textContent='•'; el.setAttribute('aria-label','tap target');
  const pad = 60, rect = tapArena.getBoundingClientRect();
  const x = Math.floor(Math.random() * Math.max(1, rect.width  - pad));
  const y = Math.floor(Math.random() * Math.max(1, rect.height - pad));
  el.style.left = `${x}px`; el.style.top = `${y}px`;
  el.dataset.id = String(id);
  const hit = (e)=>{
    e.preventDefault(); e.stopPropagation();
    if(!tapTargets.has(id)) return;
    tapScore += 1; tapUpdateStat(); SFX.ignite();
    const node = tapTargets.get(id); tapTargets.delete(id); node?.remove();
    if(tapRunning && tapTargets.size === 0){ setTimeout(tapSpawnWave, 0); }
  };
  el.addEventListener('pointerdown', hit, {passive:false});
  el.addEventListener('click', hit, {passive:false});
  tapArena.appendChild(el); tapTargets.set(id, el);
}
function tapStartGame(){ if(tapRunning) return; SFX.ensure(); SFX.whoosh(); tapRunning = true; tapSpawnWave(); }
function tapStopGame(){ tapRunning = false; }
function tapResetGame(){ tapStopGame(); tapScore = 0; tapUpdateStat(); tapTargets.forEach(n=>n.remove()); tapTargets.clear(); }

tapStart.addEventListener('click', tapStartGame);
tapStopBtn.addEventListener('click', tapStopGame);
tapReset.addEventListener('click', tapResetGame);
tapUpdateStat();

/* ===== Reflex Sprint (unchanged) ===== */
const reflexArena = document.getElementById('reflexArena');
const reflexStart = document.getElementById('reflexStart');
const reflexStopBtn  = document.getElementById('reflexStop');
const reflexReset = document.getElementById('reflexReset');
const reflexStat  = document.getElementById('reflexStat');
const reflexActionEl = document.getElementById('reflexAction');

let reflexRunning = false;
let reflexScore = 0;
let currentAction = null; // 'tap','left','right','up','down'

function setActionText(a){
  reflexActionEl.textContent = a === 'tap' ? 'TAP' : a === 'left' ? '←' : a === 'right' ? '→' : a === 'up' ? '↑' : '↓';
}
function nextAction(){
  const actions = ['tap','left','right','up','down'];
  currentAction = actions[Math.floor(Math.random()*actions.length)];
  setActionText(currentAction);
}
function reflexUpdate(){ reflexStat.textContent = `Score: ${reflexScore}`; }
function flashBad(){ reflexArena.classList.add('flashBad'); setTimeout(()=>reflexArena.classList.remove('flashBad'), 150); }
function failReset(){ reflexScore = 0; reflexUpdate(); flashBad(); SFX.boom(); nextAction(); }
function success(){ reflexScore += 1; reflexUpdate(); SFX.ignite(); nextAction(); }

function reflexStartGame(){ if(reflexRunning) return; SFX.ensure(); reflexRunning = true; reflexScore = 0; reflexUpdate(); SFX.whoosh(); nextAction(); }
function reflexStopGame(){ reflexRunning = false; }
function reflexResetGame(){ reflexStopGame(); reflexScore = 0; reflexUpdate(); currentAction = null; reflexActionEl.textContent = '—'; }

reflexStart.addEventListener('click', reflexStartGame);
reflexStopBtn.addEventListener('click', reflexStopGame);
reflexReset.addEventListener('click', reflexResetGame);

/* Mobile / desktop input handling (unchanged) */
let sx=0, sy=0, st=0, tracking=false;
const MAX_TIME = 700, MIN_DIST = 35, TAP_MAX_DIST = 14, TAP_MAX_TIME = 300;

function getPoint(e, useChanged=false){
  if (e.changedTouches && e.changedTouches.length && useChanged){
    return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
  }
  if (e.touches && e.touches.length){
    return { x: e.touches[0].clientX, y: e.touches[0].clientY };
  }
  return { x: e.clientX, y: e.clientY };
}

function onReflexDownEvent(e){
  if(!reflexRunning) return;
  if(e.cancelable) e.preventDefault(); // prevent scroll while swiping
  const p = getPoint(e, false);
  tracking = true; sx = p.x; sy = p.y; st = performance.now();
}
function onReflexUpEvent(e){
  if(!reflexRunning || !tracking) return;
  tracking = false;
  const p = getPoint(e, true);
  const dx = p.x - sx, dy = p.y - sy, dt = performance.now() - st;

  let input = null;
  if(dt <= TAP_MAX_TIME && Math.hypot(dx,dy) <= TAP_MAX_DIST){
    input = 'tap';
  } else if(dt <= MAX_TIME){
    if(Math.abs(dx) > Math.abs(dy) && Math.abs(dx) >= MIN_DIST){
      input = dx > 0 ? 'right' : 'left';
    } else if(Math.abs(dy) >= MIN_DIST){
      input = dy > 0 ? 'down' : 'up';
    }
  }

  if(!input){ failReset(); return; }
  if(input === currentAction) success(); else failReset();
}

/* Listeners */
reflexArena.addEventListener('pointerdown', onReflexDownEvent, {passive:false});
reflexArena.addEventListener('mousedown', onReflexDownEvent, {passive:false});
reflexArena.addEventListener('touchstart', onReflexDownEvent, {passive:false});
window.addEventListener('pointerup', onReflexUpEvent, {passive:true});
window.addEventListener('mouseup', onReflexUpEvent, {passive:true});
window.addEventListener('touchend', onReflexUpEvent, {passive:true});
window.addEventListener('touchcancel', onReflexUpEvent, {passive:true});
window.addEventListener('pointercancel', onReflexUpEvent, {passive:true});

/* Start on hub */
showGamesHub();
</script>
</body>
</html>
