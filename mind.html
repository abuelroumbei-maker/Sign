<!doctype html> 
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mind</title>
<meta name="theme-color" content="#0b0d12" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --fg:#e2e8f0; --muted:#94a3b8; --card:#ffffffdd;
    --accent:#3b82f6; --accent2:#bfdbfe; --accent3:#60a5fa;
    --success1:#10b981; --success2:#34d399;
    --warn1:#f59e0b; --warn2:#fbbf24;
    --info1:#a78bfa; --info2:#7dd3fc;
    --market1:#60a5fa; --market2:#fb7185; --market3:#34d399;
    --bg1:#0b0d12; --bg2:#0e1320;
    --tyrian:#66023C;
    --outline:#FFD700;
    --title-font: "Press Start 2P", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    --body-font:  ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:var(--body-font);color:#fff;background:#0b0d12;overflow:hidden;}

  .bg{
    position:fixed; inset:0; z-index:-4;
    background:
      radial-gradient(1100px 700px at 15% 20%, color-mix(in oklab, var(--accent) 45%, transparent), transparent 60%),
      radial-gradient(1000px 700px at 85% 30%, color-mix(in oklab, var(--accent2) 45%, transparent), transparent 60%),
      radial-gradient(900px 700px at 40% 90%, color-mix(in oklab, var(--accent3) 35%, transparent), transparent 60%),
      linear-gradient(120deg, var(--bg1), var(--bg2) 50%, var(--bg1));
    animation:bgDrift 20s ease-in-out infinite alternate; filter:saturate(1.05) brightness(1.03);
  }
  @keyframes bgDrift{from{transform:translateX(0)} to{transform:translateX(-1.6%)}}
  #stars{position:fixed; inset:0; pointer-events:none; z-index:-3}

  .nav{position:fixed;left:18px;top:18px;display:flex;gap:10px;flex-wrap:wrap;z-index:50}
  .pill{display:inline-block;padding:8px 12px;border-radius:999px;background:#ffffffdd;color:#0a0b0f;font-weight:800;text-decoration:none}

  .xpWrap{position:fixed; right:18px; top:18px; display:flex; align-items:center; gap:12px; max-width:min(520px, 70vw);z-index:50;}
  .xp-badge{background:#ffffffdd;color:#0a0b0f;border-radius:12px;padding:6px 10px;font-size:13px;font-weight:800;box-shadow:0 8px 18px rgba(0,0,0,.15)}
  .xp-bar{flex:1;height:10px;border-radius:999px;background:rgba(255,255,255,.22);overflow:hidden;position:relative;box-shadow:inset 0 2px 6px rgba(0,0,0,.25)}
  .xp-fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));box-shadow:0 6px 20px rgba(13,148,255,.35);transition:width .45s ease}
  .xp-meta{position:fixed;right:18px;top:52px;font-size:12px;color:#cbd5e1;opacity:.9;z-index:50}

  .wrap{height:100%;display:grid;grid-template-rows:auto 1fr;gap:8px;padding:22px}

  .title{
    margin:0;
    font-family:var(--title-font);
    font-weight:900;
    font-size:clamp(36px,9vw,72px);
    line-height:1.08;
    color:var(--tyrian);
    letter-spacing:1px; text-align:center;
    -webkit-text-stroke: 2px var(--outline);
    text-shadow:0 0 10px rgba(255,215,0,.25), 0 10px 28px rgba(0,0,0,.35), 0 0 28px rgba(102,2,60,.25);
  }

  .game{
    min-height:0;
    display:grid;
    grid-template-rows:auto auto 1fr;
    gap:22px;
    max-width:1180px;
    margin:28px auto 0;
    width:100%;
    padding-top:10px;
  }

  .start-wrap{display:grid;justify-items:center;gap:14px}
  .start-buttons{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}

  .btn{
    appearance:none;border:none;border-radius:16px;padding:16px 24px;font-weight:900;
    cursor:pointer;transition:transform .08s ease, box-shadow .1s ease, opacity .2s ease
  }
  .btn:active{transform:translateY(1px)}
  .btn-lg{font-size:18px;padding:20px 30px;border-radius:18px}
  .btn-primary{ color:#0b0d12; background:linear-gradient(90deg,var(--accent),var(--accent3)); box-shadow:0 14px 28px rgba(59,130,246,.38), inset 0 -2px 0 rgba(255,255,255,.25); }
  .btn-success{ color:#052e24; background:linear-gradient(90deg,var(--success1),var(--success2)); box-shadow:0 14px 28px rgba(16,185,129,.38), inset 0 -2px 0 rgba(255,255,255,.25); }
  .btn-warn{ color:#251a00; background:linear-gradient(90deg,var(--warn1),var(--warn2)); box-shadow:0 14px 28px rgba(245,158,11,.38), inset 0 -2px 0 rgba(255,255,255,.25); }
  .btn-info{ color:#0b0b12; background:linear-gradient(90deg,var(--info1),var(--info2)); box-shadow:0 14px 28px rgba(167,139,250,.38), inset 0 -2px 0 rgba(255,255,255,.25); }
  .btn-ghost{background:rgba(255,255,255,.08); color:#e2e8f0; border:1px solid rgba(255,255,255,.16)}
  .subtitle{margin:0;text-align:center;color:#94a3b8;font-size:14px}

  .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:4px}
  .spacer{flex:1 1 auto}

  .fact-grid{ display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr)); gap:12px;align-content:start;overflow:auto;padding-bottom:8px }
  .fact-card{
    --h:210;
    position:relative;
    background:linear-gradient(180deg, hsla(var(--h),80%,60%,.16), hsla(var(--h),80%,40%,.08));
    border:1px solid hsla(var(--h),85%,70%,.35);
    border-radius:14px;padding:10px 12px 12px;backdrop-filter:blur(6px);
    transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .2s ease;
    cursor:pointer;min-height:92px;
    box-shadow:0 6px 18px hsla(var(--h),80%,50%,.18);
  }
  .fact-card:hover{transform:translateY(-2px); box-shadow:0 12px 30px hsla(var(--h),80%,55%,.28); border-color:hsla(var(--h),85%,75%,.55);}
  .fact-title{font-weight:900;margin:0 0 4px 0;color:#fff;font-size:14px}
  .fact-blurb{margin:0;color:#dbe7ff;font-size:12.5px;line-height:1.35;opacity:.95}

  .panel{
    position:relative;
    background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);
    border-radius:18px;padding:18px 18px 20px;backdrop-filter:blur(8px);
    display:grid;gap:14px;max-width:980px;justify-self:center;
    box-shadow:0 18px 36px rgba(0,0,0,.25);
    overflow:hidden;
  }
  .panel.glow{ animation:panelGlow 700ms ease-out; }
  @keyframes panelGlow{
    0%{ box-shadow:0 0 0 rgba(102,2,60,.0); border-color:rgba(255,255,255,.14); }
    30%{ box-shadow:0 0 40px rgba(102,2,60,.35), 0 18px 36px rgba(0,0,0,.25); border-color:rgba(255,255,255,.28); }
    100%{ box-shadow:0 18px 36px rgba(0,0,0,.25); border-color:rgba(255,255,255,.14); }
  }
  .ripple{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%) scale(0);
    width:280px; height:280px; border-radius:50%;
    background:radial-gradient(closest-side, rgba(102,2,60,.28), rgba(96,165,250,.22), transparent 70%);
    pointer-events:none; filter:blur(.6px); opacity:.9;
    animation:rippleAnim 700ms ease-out forwards;
  }
  @keyframes rippleAnim{ to{ transform:translate(-50%,-50%) scale(1.6); opacity:0; } }

  .evo-badge{font-size:12px;color:#cbd5e1;opacity:.95}
  .evo-text{font-size:18px;line-height:1.5;margin:0;color:#fff}
  .evo-text.pop{ animation:textPop 160ms ease-out; }
  @keyframes textPop{ 0%{ transform:scale(0.985); filter:blur(.2px); opacity:.96; } 100%{ transform:scale(1); filter:blur(0); opacity:1; } }

  /* Countries */
  .country-row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .country-input{
    flex:1; min-width:220px;
    border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:rgba(255,255,255,.06); color:#fff; padding:12px 14px; font:600 14px/1.4 var(--body-font); outline:none;
  }
  .country-list{display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px; max-height:46vh; overflow:auto}
  .country-item{padding:10px 12px; border:1px solid rgba(255,255,255,.12); border-radius:12px; background:rgba(255,255,255,.06); cursor:pointer}
  .country-item b{display:block; font-size:14px}
  .country-facts{display:grid; gap:10px}

  /* Markets */
  .market-columns{display:grid; grid-template-columns:1fr 1fr; gap:14px}
  .col{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:12px}
  .col h3{margin:.2rem 0 .6rem}
  .sig{display:grid; gap:6px}
  .sig-item{display:flex; gap:8px; align-items:flex-start; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:8px 10px}
  .badge-pill{font-size:11px; font-weight:900; padding:4px 8px; border-radius:999px; color:#0b0d12; background:#93c5fd}
  .badge-sell{background:#fda4af}
  .sig-meta{font-size:12px; color:#cfe2ff}
  .disc{font-size:12px; color:#cbd5e1}

  /* Games */
  .games-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px}
  .game-card{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:12px}
  .game-card h3{margin:.2rem 0 .4rem}
  .field{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:6px 0}
  .input{flex:1; min-width:220px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; padding:10px 12px; font:600 14px/1.4 var(--body-font); outline:none}
  .role-pill{padding:6px 10px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14); border-radius:999px; font-size:12px}

  .scrolly{overflow:auto;min-height:0}
  .hidden{display:none !important}

  @media (max-width: 480px){
    .nav{top:12px;left:12px}
    .xpWrap{top:12px;right:12px}
    .xp-meta{top:46px;right:12px}
    .wrap{padding:96px 14px 18px}
    .title{font-size:clamp(28px, 9.5vw, 44px); line-height:1.12; letter-spacing:.8px; -webkit-text-stroke: 1px var(--outline); text-shadow:0 0 8px rgba(255,215,0,.22), 0 8px 24px rgba(0,0,0,.35), 0 0 20px rgba(102,2,60,.20)}
    .game{gap:18px; margin-top:22px}
    .btn-lg{font-size:16px;padding:16px 22px}
    .subtitle{font-size:12px}
    .fact-grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
    .fact-card{min-height:88px;padding:10px}
    .evo-text{font-size:16px}
    .t-node{min-width:140px}
    .market-columns{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div class="bg"></div>
  <canvas id="stars"></canvas>

  <div class="nav">
    <a class="pill" href="index.html">← Home</a>
    <a class="pill" href="body.html">Body</a>
    <a class="pill" href="heart.html">Heart</a>
    <a class="pill" href="soul.html">Soul</a>
  </div>

  <div class="xpWrap">
    <div class="xp-badge" id="xpBadge">Level 0</div>
    <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
  </div>
  <div class="xp-meta" id="xpMeta">0 / 200 XP</div>

  <div class="wrap">
    <h1 class="title">Mind</h1>

    <section class="game">
      <div id="startView" class="start-wrap">
        <div class="start-buttons">
          <button id="btnStartGame" class="btn btn-primary btn-lg" aria-describedby="startDesc">Fact Evolution</button>
          <button id="btnFactChecker" class="btn btn-success btn-lg">Fact checker</button>
          <button id="btnConspiracy" class="btn btn-warn btn-lg">Fun Conspiracy Theories</button>
          <button id="btnHistory" class="btn btn-primary btn-lg">Entire History of the World</button>
          <button id="btnDictionary" class="btn btn-info btn-lg">Dictionary of the World</button>
          <button id="btnCountries" class="btn btn-primary btn-lg">Countries of the World</button>
          <button id="btnMarkets" class="btn btn-success btn-lg">What to buy/sell</button>
          <button id="btnGames" class="btn btn-warn btn-lg">Mind Games</button>
        </div>
        <p id="startDesc" class="subtitle">Begin with a fact, then evolve it layer by layer.</p>
      </div>

      <!-- Existing views preserved... -->
      <div id="factListView" class="scrolly hidden"><div class="fact-grid" id="factGrid"></div></div>
      <div id="evoView" class="panel hidden">
        <div class="evo-badge" id="evoMeta"></div>
        <p class="evo-text" id="evoText"></p>
        <div class="actions">
          <button class="btn btn-primary" id="btnDeeper">EVOLVE</button>
          <span class="spacer"></span>
          <button class="btn btn-ghost" id="btnExit">I’m no longer interested</button>
        </div>
      </div>

      <!-- Fact checker -->
      <div id="fcView" class="panel hidden">
        <div class="evo-badge">Fact checker</div>
        <textarea id="fcInput" class="fc-textarea" placeholder="Type a fact, e.g. “The Sahara is the largest hot desert.”"></textarea>
        <div class="actions" style="align-items:center">
          <span id="fcBadge" class="badge badge-unknown hidden">UNKNOWN</span>
          <span id="fcMsg" style="font-size:13px;color:#cbd5e1"></span>
          <span class="spacer"></span>
          <button id="btnFcBack" class="btn btn-ghost">Back</button>
          <button id="btnFcCheck" class="btn btn-success">Check</button>
          <button id="btnFcEvolve" class="btn btn-primary hidden">EVOLVE</button>
        </div>
        <div id="fcExplanation" class="evo-text hidden"></div>
      </div>

      <!-- Conspiracies -->
      <div id="ctView" class="panel hidden">
        <div class="evo-badge">Fun Conspiracy Theories (entertainment • rate it!)</div>
        <h3 id="ctTitle" class="ct-title"></h3>
        <p id="ctText" class="ct-text"></p>
        <div class="actions" style="align-items:center">
          <div class="stars" aria-label="Rate this theory">
            <span class="rating-hint" id="ctAvg" style="margin-right:6px">—</span>
            <button class="star" data-star="1" aria-label="1 star"></button>
            <button class="star" data-star="2" aria-label="2 stars"></button>
            <button class="star" data-star="3" aria-label="3 stars"></button>
            <button class="star" data-star="4" aria-label="4 stars"></button>
            <button class="star" data-star="5" aria-label="5 stars"></button>
          </div>
          <span class="spacer"></span>
          <button id="btnCtBack" class="btn btn-ghost">Back</button>
          <button id="btnCtAnother" class="btn btn-warn">Another one</button>
        </div>
      </div>

      <!-- History -->
      <div id="histView" class="panel hidden">
        <div class="evo-badge">Entire History of the World — tap a milestone, then EVOLVE</div>
        <div class="timeline-wrap"><div class="timeline" id="timeline"></div></div>
        <div id="histDetail" class="hidden">
          <hr style="border-color:rgba(255,255,255,.12);border-width:0 0 1px;margin:8px 0 6px">
          <div class="evo-badge" id="histMeta"></div>
          <p class="evo-text" id="histText"></p>
          <div class="actions">
            <button class="btn btn-primary" id="btnHistEvolve">EVOLVE</button>
            <span class="spacer"></span>
            <button class="btn btn-ghost" id="btnHistBack">Back</button>
          </div>
        </div>
        <div class="actions hidden" id="histBackRow">
          <span class="spacer"></span>
          <button class="btn btn-ghost" id="btnHistClose">Close</button>
        </div>
      </div>

      <!-- Dictionary -->
      <div id="dictView" class="panel hidden">
        <div class="evo-badge">Dictionary of the World</div>
        <div class="dict-row">
          <input id="dictQuery" class="dict-input" type="text" placeholder="Search a word… (press Enter)">
          <span class="spacer"></span>
          <button id="btnDictBack" class="btn btn-ghost">Back</button>
          <button id="btnDictSearch" class="btn btn-info">Search</button>
        </div>
        <div id="dictResult" class="dict-result hidden">
          <h3 id="dictWord"></h3>
          <div id="dictMeta" class="dict-meta"></div>
          <div id="dictDefs"></div>
        </div>
      </div>

      <!-- Countries of the World -->
      <div id="countriesView" class="panel hidden">
        <div class="evo-badge">Countries of the World — search or pick, then EVOLVE facts</div>
        <div class="country-row">
          <input id="countryQuery" class="country-input" placeholder="Search country by name…">
          <span class="spacer"></span>
          <button id="btnCountriesBack" class="btn btn-ghost">Back</button>
        </div>
        <div class="country-list" id="countryList"></div>
        <div id="countryDetail" class="country-facts hidden">
          <hr style="border-color:rgba(255,255,255,.12);border-width:0 0 1px;margin:8px 0 6px">
          <div class="evo-badge" id="countryMeta"></div>
          <p class="evo-text" id="countryText"></p>
          <div class="actions">
            <button class="btn btn-primary" id="btnCountryEvolve">EVOLVE</button>
            <span class="spacer"></span>
            <button class="btn btn-ghost" id="btnCountryClose">Close</button>
          </div>
        </div>
      </div>

      <!-- What to buy/sell (demo) -->
      <div id="marketsView" class="panel hidden">
        <div class="evo-badge">What to buy/sell — daily demo signals (education only)</div>
        <div class="actions" style="align-items:center">
          <div id="marketDate" class="sig-meta"></div>
          <span class="spacer"></span>
          <button id="btnMarketsBack" class="btn btn-ghost">Back</button>
          <button id="btnMarketsRefresh" class="btn btn-success">Refresh (today)</button>
        </div>
        <div class="market-columns">
          <div class="col">
            <h3>BUY</h3>
            <div id="buyList" class="sig"></div>
          </div>
          <div class="col">
            <h3>SELL / AVOID</h3>
            <div id="sellList" class="sig"></div>
          </div>
        </div>
        <p class="disc">These are auto-generated demo picks that refresh daily and are <b>not financial advice</b>. For real expert signals, we can wire a backend/API later.</p>
      </div>

      <!-- Mind Games -->
      <div id="gamesView" class="panel hidden">
        <div class="evo-badge">Mind Games — quick social games for 2+ players</div>
        <div class="games-grid">
          <div class="game-card">
            <h3>Imposter</h3>
            <div class="field"><input id="playersImposter" class="input" placeholder="Comma-separated player names (e.g., Alex, Sam, Noor)"></div>
            <div class="field">
              <button id="btnAssignImposter" class="btn btn-warn">Assign Roles</button>
              <button id="btnRevealImposter" class="btn btn-primary">Reveal Roles</button>
              <button id="btnImposterTimer" class="btn btn-ghost">3:00 Timer</button>
            </div>
            <div id="rolesImposter" class="field"></div>
          </div>
          <div class="game-card">
            <h3>Act-It-Out</h3>
            <div class="field"><input id="playersAct" class="input" placeholder="Player names…"></div>
            <div class="field">
              <button id="btnActPrompt" class="btn btn-success">New Prompt</button>
              <button id="btnActTimer" class="btn btn-ghost">0:45 Timer</button>
            </div>
            <div id="actPrompt" class="evo-text"></div>
          </div>
        </div>
      </div>

    </section>
  </div>

<script>
/* ---------- Stars ---------- */
const stars=document.getElementById('stars'), sctx=stars.getContext('2d');
function resize(){ stars.width=innerWidth; stars.height=innerHeight; } resize(); addEventListener('resize',resize);
const STARS=Array.from({length:160}).map(()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,z:Math.random()*1.5+.3,dx:(Math.random()-.5)*0.15,dy:(Math.random()-.5)*0.15}));
(function draw(){ requestAnimationFrame(draw); sctx.clearRect(0,0,stars.width,stars.height);
  STARS.forEach(s=>{ s.x+=s.dx*s.z; s.y+=s.dy*s.z;
    if(s.x<0)s.x+=stars.width; if(s.x>stars.width)s.x-=stars.width; if(s.y<0)s.y+=stars.height; if(s.y>stars.height)s.y-=stars.height;
    sctx.fillStyle=`rgba(255,255,255,${0.25*s.z})`; sctx.fillRect(s.x,s.y,1.2*s.z,1.2*s.z); }); })();

/* ---------- XP ---------- */
function loadXP(){ try{ return JSON.parse(localStorage.getItem("xp_v1")) || {level:0, xp:0}; } catch { return {level:0, xp:0}; } }
const MAX_LEVEL=100; function xpForNext(level){ if(level>=MAX_LEVEL)return Infinity; const base=200,growth=1.12; return Math.round(base*Math.pow(growth,level)); }
function updateXPUI(){ const xp=loadXP(); const need=xpForNext(xp.level);
  document.getElementById('xpBadge').textContent=`Level ${xp.level}`;
  document.getElementById('xpFill').style.width=(xp.level>=MAX_LEVEL?100:Math.round(100*(xp.xp/need)))+"%";
  document.getElementById('xpMeta').textContent=xp.level>=MAX_LEVEL?`MAX • Level ${MAX_LEVEL}`:`${xp.xp} / ${need} XP`;
}
updateXPUI(); document.addEventListener('visibilitychange',()=>{ if(!document.hidden) updateXPUI(); });

/* ---------- Existing Fact Evolution game ---------- */
const FACTS = [
  {id:"sahara",title:"Sahara Desert",layers:[
    "The Sahara is the largest hot desert on Earth.",
    "It spans about 9 million km² across North Africa.",
    "Average rainfall is typically under 100 mm per year.",
    "Day–night swings can reach from ~50°C to near freezing."]},
  {id:"light",title:"Speed of Light",layers:[
    "Light in vacuum travels at a constant speed.",
    "That constant is ~299,792 km per second.",
    "It’s commonly rounded to 3×10⁵ km/s for simplicity.",
    "This limit shapes causality in modern physics."]},
  {id:"honey",title:"Honey & Spoilage",layers:[
    "Honey can last a very long time.",
    "Its low water activity inhibits microbial growth.",
    "Acidity (~pH 3–4.5) and hydrogen peroxide help preservation.",
    "Archaeologists have found edible honey in ancient tombs."]}
];

const startViewEl=document.getElementById('startView');
const btnStartGame=document.getElementById('btnStartGame');
const btnFactChecker=document.getElementById('btnFactChecker');
const btnConspiracy=document.getElementById('btnConspiracy');
const btnHistory=document.getElementById('btnHistory');
const btnDictionary=document.getElementById('btnDictionary');
const btnCountries=document.getElementById('btnCountries');
const btnMarkets=document.getElementById('btnMarkets');
const btnGames=document.getElementById('btnGames');

const factGridEl=document.getElementById('factGrid');
const listViewEl=document.getElementById('factListView');
const evoViewEl=document.getElementById('evoView');
const evoMetaEl=document.getElementById('evoMeta');
const evoTextEl=document.getElementById('evoText');
const btnDeeper=document.getElementById('btnDeeper');
const btnExit=document.getElementById('btnExit');

/* Fact checker els */
const fcViewEl=document.getElementById('fcView'), fcInputEl=document.getElementById('fcInput'), fcBadgeEl=document.getElementById('fcBadge'), fcMsgEl=document.getElementById('fcMsg'), fcExplainEl=document.getElementById('fcExplanation');
const btnFcBack=document.getElementById('btnFcBack'), btnFcCheck=document.getElementById('btnFcCheck'), btnFcEvolve=document.getElementById('btnFcEvolve');

/* Conspiracy els */
const ctViewEl=document.getElementById('ctView'), ctTitleEl=document.getElementById('ctTitle'), ctTextEl=document.getElementById('ctText'), btnCtBack=document.getElementById('btnCtBack'), btnCtAnother=document.getElementById('btnCtAnother'), ctAvgEl=document.getElementById('ctAvg');

/* History els */
const histViewEl=document.getElementById('histView'), timelineEl=document.getElementById('timeline'), histDetailEl=document.getElementById('histDetail'), histMetaEl=document.getElementById('histMeta'), histTextEl=document.getElementById('histText');
const btnHistEvolve=document.getElementById('btnHistEvolve'), btnHistBack=document.getElementById('btnHistBack'), btnHistClose=document.getElementById('btnHistClose'), histBackRowEl=document.getElementById('histBackRow');

/* Dictionary els */
const dictViewEl=document.getElementById('dictView'), dictQueryEl=document.getElementById('dictQuery'), dictResultEl=document.getElementById('dictResult'), dictWordEl=document.getElementById('dictWord'), dictMetaEl=document.getElementById('dictMeta'), dictDefsEl=document.getElementById('dictDefs');
const btnDictBack=document.getElementById('btnDictBack'), btnDictSearch=document.getElementById('btnDictSearch');

/* Countries els */
const countriesViewEl=document.getElementById('countriesView');
const countryQueryEl=document.getElementById('countryQuery'), countryListEl=document.getElementById('countryList');
const countryDetailEl=document.getElementById('countryDetail'), countryMetaEl=document.getElementById('countryMeta'), countryTextEl=document.getElementById('countryText');
const btnCountryEvolve=document.getElementById('btnCountryEvolve'), btnCountryClose=document.getElementById('btnCountryClose'), btnCountriesBack=document.getElementById('btnCountriesBack');

/* Markets els */
const marketsViewEl=document.getElementById('marketsView'), buyListEl=document.getElementById('buyList'), sellListEl=document.getElementById('sellList'), marketDateEl=document.getElementById('marketDate');
const btnMarketsBack=document.getElementById('btnMarketsBack'), btnMarketsRefresh=document.getElementById('btnMarketsRefresh');

/* Games els */
const gamesViewEl=document.getElementById('gamesView');
const playersImposterEl=document.getElementById('playersImposter'), rolesImposterEl=document.getElementById('rolesImposter');
const btnAssignImposter=document.getElementById('btnAssignImposter'), btnRevealImposter=document.getElementById('btnRevealImposter'), btnImposterTimer=document.getElementById('btnImposterTimer');
const playersActEl=document.getElementById('playersAct'), actPromptEl=document.getElementById('actPrompt'), btnActPrompt=document.getElementById('btnActPrompt'), btnActTimer=document.getElementById('btnActTimer');

let currentFact=null, layerIndex=0;

/* ---------- Views ---------- */
function hideAll(){
  startViewEl.classList.add('hidden'); listViewEl.classList.add('hidden'); evoViewEl.classList.add('hidden');
  fcViewEl.classList.add('hidden'); ctViewEl.classList.add('hidden'); histViewEl.classList.add('hidden');
  dictViewEl.classList.add('hidden'); countriesViewEl.classList.add('hidden'); marketsViewEl.classList.add('hidden'); gamesViewEl.classList.add('hidden');
}
function showStart(){ hideAll(); startViewEl.classList.remove('hidden'); currentFact=null; layerIndex=0; }
function showList(){ hideAll(); listViewEl.classList.remove('hidden'); }
function showEvo(){ hideAll(); evoViewEl.classList.remove('hidden'); }
function showFc(){ hideAll(); fcViewEl.classList.remove('hidden'); }
function showCt(){ hideAll(); ctViewEl.classList.remove('hidden'); }
function showHist(){ hideAll(); histViewEl.classList.remove('hidden'); }
function showDict(){ hideAll(); dictViewEl.classList.remove('hidden'); }
function showCountries(){ hideAll(); countriesViewEl.classList.remove('hidden'); }
function showMarkets(){ hideAll(); marketsViewEl.classList.remove('hidden'); }
function showGames(){ hideAll(); gamesViewEl.classList.remove('hidden'); }

/* ---------- Renderers ---------- */
function renderFactGrid(){
  factGridEl.innerHTML='';
  const hues=[200,265,150,15,330,185,95,40,280,125,355,210];
  FACTS.forEach((f,i)=>{
    const h=hues[i%hues.length];
    const card=document.createElement('button');
    card.className='fact-card';
    card.style.setProperty('--h',h);
    card.innerHTML=`<div class="fact-title">${escapeHTML(f.title)}</div><p class="fact-blurb">${escapeHTML(f.layers[0])}</p>`;
    card.addEventListener('click',()=>{ playClick(); beginEvolution(f.id); });
    factGridEl.appendChild(card);
  });
}
function beginEvolution(fid){ currentFact=FACTS.find(x=>x.id===fid); layerIndex=0; updateEvoPanel(); showEvo(); }
function updateEvoPanel(){
  const total=currentFact.layers.length;
  evoTextEl.textContent=currentFact.layers[layerIndex];
  evoMetaEl.textContent=`Layer ${layerIndex+1} of ${total} • ${currentFact.title}`;
  btnDeeper.disabled=(layerIndex>=total-1); btnDeeper.style.opacity=(layerIndex>=total-1?0.6:1);
}

/* ---------- Buttons ---------- */
btnStartGame.addEventListener('click',()=>{ playClick(); renderFactGrid(); showList(); });
btnFactChecker.addEventListener('click',()=>{ playClick(); resetFactChecker(); showFc(); });
btnConspiracy.addEventListener('click',()=>{ playClick(); showRandomTheory(); showCt(); setupStars(); });
btnHistory.addEventListener('click',()=>{ playClick(); renderTimeline(); showHist(); });
btnDictionary.addEventListener('click',()=>{ playClick(); resetDictionary(); showDict(); });
btnCountries.addEventListener('click',()=>{ playClick(); renderCountryList(); showCountries(); });
btnMarkets.addEventListener('click',()=>{ playClick(); buildDailySignals(); showMarkets(); });
btnGames.addEventListener('click',()=>{ playClick(); resetGames(); showGames(); });

btnDeeper.addEventListener('click',()=>{
  if(!currentFact) return;
  if(layerIndex < currentFact.layers.length-1){
    layerIndex++; updateEvoPanel(); playEvolve();
    evoTextEl.classList.remove('pop'); void evoTextEl.offsetWidth; evoTextEl.classList.add('pop');
    evoViewEl.classList.remove('glow'); void evoViewEl.offsetWidth; evoViewEl.classList.add('glow');
    const r=document.createElement('span'); r.className='ripple'; evoViewEl.appendChild(r); r.addEventListener('animationend',()=>r.remove(),{once:true});
  }else{ playClick(); evoViewEl.classList.remove('glow'); void evoViewEl.offsetWidth; evoViewEl.classList.add('glow'); }
});
btnExit.addEventListener('click',()=>{ playClick(); showStart(); });

/* ---------- Fact checker ---------- */
function resetFactChecker(){
  fcInputEl.value=''; fcBadgeEl.className='badge badge-unknown hidden'; fcBadgeEl.textContent='UNKNOWN';
  fcMsgEl.textContent=''; fcExplainEl.textContent=''; fcExplainEl.classList.add('hidden'); btnFcEvolve.classList.add('hidden');
}
btnFcBack.addEventListener('click',()=>{ playClick(); showStart(); });
btnFcCheck.addEventListener('click',()=>{
  playClick();
  const text=fcInputEl.value.trim(); if(!text){ fcMsgEl.textContent='Type a fact to check.'; fcBadgeEl.classList.add('hidden'); return; }
  const { verdict, message, explanation } = localHeuristicCheck(text);
  fcBadgeEl.classList.remove('hidden'); fcBadgeEl.textContent = verdict.toUpperCase();
  fcBadgeEl.className = 'badge ' + (verdict==='true' ? 'badge-true' : verdict==='false' ? 'badge-false' : 'badge-unknown');
  fcMsgEl.textContent = message;
  btnFcEvolve.classList.remove('hidden');
  btnFcEvolve.onclick = ()=>{ playEvolve(); fcExplainEl.textContent = explanation; fcExplainEl.classList.remove('hidden'); fcExplainEl.classList.remove('pop'); void fcExplainEl.offsetWidth; fcExplainEl.classList.add('pop'); fcViewEl.classList.remove('glow'); void fcViewEl.offsetWidth; fcViewEl.classList.add('glow'); };
});
function localHeuristicCheck(text){
  const t=text.toLowerCase();
  if(/sahara .*largest .*hot desert/.test(t)) return {verdict:'true', message:'Matches established geography references.', explanation:'The Sahara covers ~9 million km² across North Africa, the largest hot desert by area. Antarctica is larger overall but is cold-desert.'};
  if(/earth .* flat/.test(t)) return {verdict:'false', message:'Contradicted by geophysical evidence.', explanation:'Orbital mechanics, satellite imagery, and geodesy confirm an oblate spheroid Earth.'};
  if(/honey .* (never .* spoil|lasts forever)/.test(t)) return {verdict:'true', message:'Generally true with caveats.', explanation:'Low water activity, acidity, and antimicrobial compounds prevent spoilage when sealed properly.'};
  return {verdict:'unknown', message:'Ambiguous or too broad.', explanation:'Specify names, dates, units, and scope for reliable verification.'};
}

/* ---------- Conspiracies ---------- */
const THEORIES = [
  {id:'bielefeld', title:'The Bielefeld Conspiracy', text:'A long-running German in-joke claims the city of Bielefeld doesn’t exist.'},
  {id:'birds', title:'Birds Aren’t Real (satire)', text:'Satirical movement joking birds were replaced by drones.'},
  {id:'mandela', title:'The Mandela Effect', text:'Mass misremembering; “parallel timelines” is the playful angle.'},
  {id:'wow', title:'The “Wow!” Signal', text:'1977 narrowband signal once detected; origin unknown.'},
  {id:'oak', title:'Oak Island Mystery', text:'Tales of booby-trapped treasure pits in Nova Scotia.'},
  {id:'shakespeare', title:'Who Wrote Shakespeare?', text:'Minority proposes alternative authors; mainstream credits Shakespeare.'}
];
const CT_RATINGS_KEY='ct_ratings_v1';
function loadRatings(){ try{ return JSON.parse(localStorage.getItem(CT_RATINGS_KEY))||{} } catch{ return {} } }
function saveRatings(r){ localStorage.setItem(CT_RATINGS_KEY, JSON.stringify(r)); }
let currentTheory=null;
function showRandomTheory(){ const pick = THEORIES[Math.floor(Math.random()*THEORIES.length)]; currentTheory = pick; ctTitleEl.textContent = pick.title; ctTextEl.textContent  = pick.text; updateCtAverageUI(); }
btnCtAnother.addEventListener('click',()=>{ playClick(); showRandomTheory(); ctViewEl.classList.remove('glow'); void ctViewEl.offsetWidth; ctViewEl.classList.add('glow'); });
btnCtBack.addEventListener('click',()=>{ playClick(); showStart(); });
function setupStars(){
  const starBtns = ctViewEl.querySelectorAll('.star');
  starBtns.forEach(btn=>{
    btn.innerHTML = starSVG(false);
    btn.onmouseenter = ()=> highlightStars(+btn.dataset.star);
    btn.onmouseleave = ()=> highlightStars(0);
    btn.onclick = ()=> { playClick(); rateTheory(+btn.dataset.star); };
  });
  highlightStars(0);
}
function starSVG(filled){ return `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.2l2.89 5.85 6.46.94-4.67 4.55 1.1 6.43L12 17.77 6.22 19.97l1.1-6.43L2.65 8.99l6.46-.94L12 2.2z" ${filled? 'fill="#ffd54f"':'fill="none"'} stroke="#ffd54f" stroke-width="1.6" /></svg>`; }
function highlightStars(n){ ctViewEl.querySelectorAll('.star').forEach((btn,idx)=>{ btn.innerHTML = starSVG(idx < n); }); }
function rateTheory(stars){
  if(!currentTheory) return; const r=loadRatings(); const rec=r[currentTheory.id]||{count:0,sum:0}; rec.count++; rec.sum += stars; r[currentTheory.id]=rec; saveRatings(r); updateCtAverageUI();
}
function updateCtAverageUI(){ const r=loadRatings(); const rec=r[currentTheory.id]||{count:0,sum:0}; const avg = rec.count? (rec.sum/rec.count) : 0; ctAvgEl.textContent = rec.count? `Avg ${avg.toFixed(1)}★ • ${rec.count} rating${rec.count>1?'s':''}` : 'No ratings yet'; }

/* ---------- History timeline ---------- */
const EVENTS = [
  { id:'bigbang',  color:'var(--info2)', time:'~13.8 Ga', title:'Big Bang', blurb:'Universe begins expanding.', layers:[
    'CMB is relic radiation from the early universe.',
    'Light elements formed minutes after the Big Bang.',
    'Structure grew from tiny density fluctuations.'
  ]},
  { id:'solarsys', color:'var(--info1)', time:'~4.6 Ga', title:'Solar System', blurb:'Sun ignites; planets accrete.', layers:[
    'Inner rocky, outer gas/ice giants across frost line.',
    'Heavy bombardment cratered early worlds.',
    'Giant impact likely formed the Moon.'
  ]},
  { id:'firstlife', color:'var(--warn2)', time:'≥3.5 Ga', title:'Earliest Life', blurb:'Microbial oceans.', layers:[
    'Stromatolites record ancient mats.',
    'Hydrothermal or shallow chemistries possible origins.',
    'Oxygenation reshaped atmosphere.'
  ]},
  { id:'cambrian', color:'var(--success2)', time:'~541 Ma', title:'Cambrian', blurb:'Rapid diversification.', layers:[
    'Trilobites, anomalocaridids in fossils.',
    'Predator–prey arms races.',
    'Most major phyla appear.'
  ]},
  { id:'dinos', color:'var(--market1)', time:'252–66 Ma', title:'Dinosaurs', blurb:'Mesozoic dominance.', layers:[
    'Pangaea split into continents.',
    'Birds from theropods.',
    'Angiosperms spread in Cretaceous.'
  ]},
  { id:'kpg', color:'var(--market2)', time:'66 Ma', title:'K–Pg', blurb:'Asteroid mass extinction.', layers:[
    'Chicxulub impact tossed aerosols.',
    'Food chains collapsed.',
    'Mammals diversified later.'
  ]},
  { id:'humans', color:'var(--market3)', time:'~300 ka', title:'H. sapiens', blurb:'Modern humans emerge.', layers:[
    'Tools, art, language accelerate.',
    'Migrations out of Africa.',
    'Gene flow with Neanderthals/Denisovans.'
  ]},
  { id:'ancient', color:'var(--warn1)', time:'~3000–500 BCE', title:'Ancient Civs', blurb:'Cities, writing, trade.', layers:[
    'Law codes, monuments.',
    'Math, astronomy, calendars.',
    'Long-distance networks.'
  ]},
  { id:'middle', color:'var(--info2)', time:'~500–1500 CE', title:'Middle Ages', blurb:'Knowledge persisted.', layers:[
    'Byzantine & Islamic scholarship.',
    'Universities and innovations.',
    'Gothic architecture, exchange.'
  ]},
  { id:'renaissance', color:'var(--success2)', time:'~1300–1600', title:'Renaissance', blurb:'Arts & science bloom.', layers:[
    'Printing press spreads ideas.',
    'Heliocentrism challenges dogma.',
    'Global exploration connects worlds.'
  ]},
  { id:'industrial', color:'var(--market1)', time:'~1760–1900', title:'Industrial', blurb:'Mechanization & steam.', layers:[
    'Urbanization and new economies.',
    'Rail & telegraph compress distance.',
    'Public health & labor shifts.'
  ]},
  { id:'space', color:'var(--info1)', time:'~1957–', title:'Space Age', blurb:'Satellites & Moon.', layers:[
    'Global comms & navigation.',
    'Robotic exploration.',
    'Telescopes probe deep space.'
  ]},
  { id:'digital', color:'var(--market3)', time:'~1970–today', title:'Digital Era', blurb:'Computing & AI.', layers:[
    'Connectivity & data abundance.',
    'Automation transforms work.',
    'Privacy & ethics central.'
  ]}
];
function renderTimeline(){
  timelineEl.innerHTML='';
  EVENTS.forEach((e)=>{
    const node=document.createElement('button');
    node.className='t-node'; node.style.setProperty('--c', e.color);
    node.innerHTML=`<div class="t-time">${escapeHTML(e.time)}</div><div class="t-title">${escapeHTML(e.title)}</div><p class="t-blurb">${escapeHTML(e.blurb)}</p>`;
    node.addEventListener('click',()=>{ playClick(); openHistDetail(e.id); }); timelineEl.appendChild(node);
  });
  histDetailEl.classList.add('hidden'); histBackRowEl.classList.remove('hidden');
}
let currEvent=null, histLayer=0;
function openHistDetail(id){ currEvent = EVENTS.find(x=>x.id===id); histLayer=0; updateHistPanel(); histDetailEl.classList.remove('hidden'); }
function updateHistPanel(){
  const total=currEvent.layers.length; histTextEl.textContent = currEvent.layers[histLayer]; histMetaEl.textContent = `Layer ${histLayer+1} of ${total} • ${currEvent.title}`;
  btnHistEvolve.disabled = (histLayer>=total-1); btnHistEvolve.style.opacity = (histLayer>=total-1?0.6:1);
}
btnHistEvolve.addEventListener('click',()=>{
  if(!currEvent) return;
  if(histLayer < currEvent.layers.length-1){
    histLayer++; updateHistPanel(); playEvolve();
    histTextEl.classList.remove('pop'); void histTextEl.offsetWidth; histTextEl.classList.add('pop');
    histViewEl.classList.remove('glow'); void histViewEl.offsetWidth; histViewEl.classList.add('glow');
    const r=document.createElement('span'); r.className='ripple'; histViewEl.appendChild(r); r.addEventListener('animationend',()=>r.remove(),{once:true});
  }else{ playClick(); }
});
btnHistBack.addEventListener('click',()=>{ playClick(); histDetailEl.classList.add('hidden'); });
btnHistClose.addEventListener('click',()=>{ playClick(); showStart(); });

/* ---------- Dictionary ---------- */
const MINI_DICT = {
  "entropy": { pos:"noun", defs:["A measure of disorder or randomness in a system.","In information theory, the average information content per message."], ex:"Higher entropy means more uncertainty."},
  "zeitgeist": { pos:"noun", defs:["The defining spirit or mood of a particular period of history."], ex:"The film captured the zeitgeist of the late 1990s."},
  "serendipity": { pos:"noun", defs:["The occurrence of events by chance in a happy or beneficial way."], ex:"Meeting them was pure serendipity."},
  "ephemeral": { pos:"adjective", defs:["Lasting for a very short time; transient."], ex:"Ephemeral blooms carpet the desert after rare rains."},
  "axiom": { pos:"noun", defs:["A self-evident proposition requiring no proof."], ex:"Euclid’s postulates are foundational axioms."},
  "heuristic": { pos:"noun", defs:["A practical method not guaranteed to be optimal but sufficient for immediate goals."], ex:"We used a heuristic to get a quick estimate."},
  "dichotomy": { pos:"noun", defs:["A division into two especially mutually exclusive or contradictory groups."], ex:"The essay explores the freedom vs security dichotomy."}
};
function normalizeWord(w){
  let s=w.trim().toLowerCase().replace(/^[^a-z]+|[^a-z]+$/g,''); if(!s) return [];
  const a=[s]; if(s.endsWith('ing')&&s.length>4)a.push(s.slice(0,-3));
  if(s.endsWith('ed')&&s.length>3)a.push(s.slice(0,-2));
  if(s.endsWith('es')&&s.length>3)a.push(s.slice(0,-2));
  if(s.endsWith('s')&&s.length>2)a.push(s.slice(0,-1));
  return [...new Set(a)];
}
function resetDictionary(){ dictQueryEl.value=''; dictResultEl.classList.add('hidden'); dictWordEl.textContent=''; dictMetaEl.textContent=''; dictDefsEl.innerHTML=''; }
btnDictBack.addEventListener('click',()=>{ playClick(); showStart(); });
btnDictSearch.addEventListener('click',()=>{ playClick(); runDictionaryLookup(); });
dictQueryEl.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); playClick(); runDictionaryLookup(); }});
function runDictionaryLookup(){
  const raw=dictQueryEl.value; const vars=normalizeWord(raw); if(!vars.length){ renderDictResult('(empty)',{pos:'—',defs:['Type a word to search.']}); return; }
  let entry=null,key=null; for(const k of vars){ if(MINI_DICT[k]){ entry=MINI_DICT[k]; key=k; break; } }
  if(!entry){ renderDictResult(raw,{pos:'—',defs:['No offline entry found. Enable online dictionary later for full coverage.']}); return; }
  renderDictResult(key,entry);
}
function renderDictResult(word, entry){
  dictWordEl.textContent=word; dictMetaEl.textContent=entry.pos?`Part of speech: ${entry.pos}`:''; dictDefsEl.innerHTML='';
  (entry.defs||[]).forEach((d,i)=>{ const p=document.createElement('p'); p.className='dict-def'; p.textContent=`${i+1}. ${d}`; dictDefsEl.appendChild(p); });
  if(entry.ex){ const ex=document.createElement('p'); ex.className='dict-example'; ex.textContent=`Example: ${entry.ex}`; dictDefsEl.appendChild(ex); }
  dictResultEl.classList.remove('hidden'); dictViewEl.classList.remove('glow'); void dictViewEl.offsetWidth; dictViewEl.classList.add('glow');
}

/* ---------- Countries of the World (sample dataset) ---------- */
const COUNTRIES = [
  {id:'us', name:'United States', region:'Americas', capital:'Washington, D.C.', pop:'~331M', layers:[
    'The U.S. is a federal republic with 50 states and a capital district.',
    'Largest economy by nominal GDP; diverse geography across 6 time zones.',
    'Federal system balances national and state powers; two major parties dominate.',
    'Cultural exports in film, music, and tech have global influence.'
  ]},
  {id:'jp', name:'Japan', region:'Asia', capital:'Tokyo', pop:'~125M', layers:[
    'An island nation in the Pacific with four main islands.',
    'High life expectancy; advanced manufacturing and robotics.',
    'Shinkansen network pioneered high-speed rail.',
    'Cultural blend of tradition (Shinto/Buddhism) and modern media.'
  ]},
  {id:'fr', name:'France', region:'Europe', capital:'Paris', pop:'~68M', layers:[
    'A unitary semi-presidential republic in Western Europe.',
    'Economy mixes industry, agriculture, luxury goods, and tourism.',
    'Known for cuisine, wine, fashion, and philosophy.',
    'Hosts global institutions and is a nuclear power.'
  ]},
  {id:'br', name:'Brazil', region:'Americas', capital:'Brasília', pop:'~214M', layers:[
    'Largest country in South America by area and population.',
    'Amazon Basin contains vast biodiversity and rainforest.',
    'Major exporter of soy, iron ore, and oil; vibrant culture (music/football).',
    'Urban centers like São Paulo and Rio drive industry and services.'
  ]},
  {id:'in', name:'India', region:'Asia', capital:'New Delhi', pop:'~1.4B', layers:[
    'World’s most populous country; a federal parliamentary republic.',
    'IT services and startups are major growth engines.',
    'Rich linguistic and cultural diversity across states/UTs.',
    'Space program (ISRO) advances planetary and lunar missions.'
  ]},
  {id:'eg', name:'Egypt', region:'Africa', capital:'Cairo', pop:'~110M', layers:[
    'A transcontinental country linking North Africa and the Middle East.',
    'The Nile sustains agriculture; ancient civilization left monumental heritage.',
    'Suez Canal is a vital global shipping route.',
    'Tourism and energy are key sectors.'
  ]},
  {id:'au', name:'Australia', region:'Oceania', capital:'Canberra', pop:'~26M', layers:[
    'A continent-country with unique biodiversity.',
    'Major exports include minerals and agricultural products.',
    'High urbanization; cities clustered on coasts.',
    'Indigenous cultures date back tens of thousands of years.'
  ]},
  {id:'de', name:'Germany', region:'Europe', capital:'Berlin', pop:'~83M', layers:[
    'A federal parliamentary republic with 16 states (Länder).',
    'Export-oriented economy; engineering and autos are strong.',
    'Energy transition (Energiewende) reshapes power mix.',
    'Central role in the EU’s economy and policy.'
  ]},
  {id:'mx', name:'Mexico', region:'Americas', capital:'Mexico City', pop:'~128M', layers:[
    'Federal republic bordered by U.S., Guatemala, and Belize.',
    'Manufacturing hub integrated into North American supply chains.',
    'Ancient civilizations (Maya/Aztec) and rich culinary traditions.',
    'Tourism spans beaches, colonial towns, and archaeological sites.'
  ]},
  {id:'ng', name:'Nigeria', region:'Africa', capital:'Abuja', pop:'~225M', layers:[
    'Africa’s most populous country with diverse ethnic groups.',
    'Oil and gas are major exports; tech hubs are growing.',
    'Nollywood is among the world’s largest film industries.',
    'Rapid urbanization shapes megacities like Lagos.'
  ]}
];
let currentCountry=null, countryLayer=0;
function renderCountryList(){
  countryListEl.innerHTML='';
  COUNTRIES.forEach(c=>{
    const el=document.createElement('button');
    el.className='country-item';
    el.innerHTML=`<b>${escapeHTML(c.name)}</b><span>${escapeHTML(c.region)} • Capital: ${escapeHTML(c.capital)} • Pop: ${escapeHTML(c.pop)}</span>`;
    el.addEventListener('click',()=>{ playClick(); openCountry(c.id); });
    countryListEl.appendChild(el);
  });
  countryDetailEl.classList.add('hidden');
}
countryQueryEl.addEventListener('input', ()=>{
  const q=countryQueryEl.value.trim().toLowerCase();
  [...countryListEl.children].forEach(child=>{
    const name=child.querySelector('b').textContent.toLowerCase();
    child.style.display = name.includes(q) ? '' : 'none';
  });
});
function openCountry(id){
  currentCountry = COUNTRIES.find(x=>x.id===id); countryLayer=0; updateCountryPanel(); countryDetailEl.classList.remove('hidden');
  countriesViewEl.classList.remove('glow'); void countriesViewEl.offsetWidth; countriesViewEl.classList.add('glow');
}
function updateCountryPanel(){
  const total=currentCountry.layers.length;
  countryTextEl.textContent = currentCountry.layers[countryLayer];
  countryMetaEl.textContent = `Layer ${countryLayer+1} of ${total} • ${currentCountry.name}`;
  btnCountryEvolve.disabled = (countryLayer>=total-1);
  btnCountryEvolve.style.opacity = (countryLayer>=total-1?0.6:1);
}
btnCountryEvolve.addEventListener('click',()=>{
  if(!currentCountry) return;
  if(countryLayer<currentCountry.layers.length-1){
    countryLayer++; updateCountryPanel(); playEvolve();
    countryTextEl.classList.remove('pop'); void countryTextEl.offsetWidth; countryTextEl.classList.add('pop');
  }else{ playClick(); }
});
btnCountryClose.addEventListener('click',()=>{ playClick(); countryDetailEl.classList.add('hidden'); });
btnCountriesBack.addEventListener('click',()=>{ playClick(); showStart(); });

/* ---------- What to buy/sell (daily demo) ---------- */
function buildDailySignals(){
  const today = new Date(); const y=today.getFullYear(), m=today.getMonth()+1, d=today.getDate();
  const stamp = `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
  marketDateEl.textContent = `Daily demo signals • ${stamp}`;
  const seed = xmur3(stamp)(); // seeded RNG by date
  const rnd = mulberry32(seed);

  const universe = [
    {t:'BTC', cat:'Crypto'}, {t:'ETH', cat:'Crypto'}, {t:'SOL', cat:'Crypto'},
    {t:'AAPL', cat:'Stock'}, {t:'NVDA', cat:'Stock'}, {t:'TSLA', cat:'Stock'},
    {t:'SPY', cat:'ETF'}, {t:'QQQ', cat:'ETF'}, {t:'IWM', cat:'ETF'},
    {t:'XAUUSD', cat:'Metal'}, {t:'EURUSD', cat:'FX'}, {t:'WTI', cat:'Commodity'}
  ];
  const rationalesBuy = [
    'Momentum uptick on higher volume',
    'Breakout above recent range',
    'Pullback to support with buyers stepping in',
    'Positive catalyst expected',
    'Relative strength vs peers'
  ];
  const rationalesSell = [
    'Momentum fading at resistance',
    'Breakdown below key level',
    'Overextended after rapid run-up',
    'Negative headline risk',
    'Weakness vs peer group'
  ];
  const picks = shuffle(universe, rnd);
  const buys = picks.slice(0,5).map(x=>({...x, why:rationalesBuy[Math.floor(rnd()*rationalesBuy.length)]}));
  const sells= picks.slice(5,10).map(x=>({...x, why:rationalesSell[Math.floor(rnd()*rationalesSell.length)]}));

  renderSignals(buys,sells);
  marketsViewEl.classList.remove('glow'); void marketsViewEl.offsetWidth; marketsViewEl.classList.add('glow');
}
btnMarketsRefresh.addEventListener('click',()=>{ playClick(); buildDailySignals(); });
btnMarketsBack.addEventListener('click',()=>{ playClick(); showStart(); });
function renderSignals(buys,sells){
  buyListEl.innerHTML=''; sellListEl.innerHTML='';
  buys.forEach(x=>buyListEl.appendChild(sigNode(x.t,x.cat,x.why,false)));
  sells.forEach(x=>sellListEl.appendChild(sigNode(x.t,x.cat,x.why,true)));
}
function sigNode(ticker,cat,why,isSell){
  const div=document.createElement('div'); div.className='sig-item';
  const pill=document.createElement('span'); pill.className='badge-pill'+(isSell?' badge-sell':''); pill.textContent=cat;
  const body=document.createElement('div'); body.innerHTML=`<div><b>${ticker}</b></div><div class="sig-meta">${escapeHTML(why)}</div>`;
  div.appendChild(pill); div.appendChild(body); return div;
}
/* Seeded RNG helpers */
function xmur3(str){ for(var i=0,h=1779033703^str.length;i<str.length;i++){ h=Math.imul(h^str.charCodeAt(i),3432918353); h=h<<13|h>>>19; } return function(){ h=Math.imul(h^h>>>16,2246822507); h=Math.imul(h^h>>>13,3266489909); return (h^h>>>16)>>>0; } }
function mulberry32(a){ return function(){ var t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15, t|1); t^=t+Math.imul(t^t>>>7, t|61); return ((t^t>>>14)>>>0)/4294967296; } }
function shuffle(arr, rnd){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(rnd()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

/* ---------- Mind Games ---------- */
function resetGames(){ rolesImposterEl.innerHTML=''; actPromptEl.textContent=''; }
btnAssignImposter.addEventListener('click',()=>{
  playClick();
  const names = playersImposterEl.value.split(',').map(s=>s.trim()).filter(Boolean);
  if(names.length<2){ rolesImposterEl.textContent='Add at least 2 players.'; return; }
  const impIdx = Math.floor(Math.random()*names.length);
  rolesImposterEl.dataset.imp=names[impIdx];
  rolesImposterEl.innerHTML = names.map(n=>`<span class="role-pill">${escapeHTML(n)} • <i>role hidden</i></span>`).join(' ');
});
btnRevealImposter.addEventListener('click',()=>{
  playClick();
  const imp = rolesImposterEl.dataset.imp; if(!imp){ rolesImposterEl.textContent='Assign roles first.'; return; }
  const kids = rolesImposterEl.querySelectorAll('.role-pill');
  kids.forEach(el=>{
    const name = el.textContent.split('•')[0].trim();
    el.innerHTML = name===imp ? `${escapeHTML(name)} • <b>IMPOSTER</b>` : `${escapeHTML(name)} • <b>CREWMATE</b>`;
  });
});
btnImposterTimer.addEventListener('click',()=> startTimer(3*60, btnImposterTimer));

const PROMPTS = {
  animals:['Octopus','Giraffe','Penguin','Eagle','Kangaroo','Chameleon','Sloth'],
  actions:['Climbing a mountain','Baking a cake','Fishing','Typing fast','Painting a wall','Juggling','Rowing a boat'],
  movies:['The Matrix','Titanic','Jurassic Park','Inception','The Lion King','Star Wars']
};
btnActPrompt.addEventListener('click',()=>{
  playClick();
  const cats = Object.keys(PROMPTS);
  const cat = cats[Math.floor(Math.random()*cats.length)];
  const item = PROMPTS[cat][Math.floor(Math.random()*PROMPTS[cat].length)];
  actPromptEl.textContent = `${cat.toUpperCase()}: ${item}`;
  actPromptEl.classList.remove('pop'); void actPromptEl.offsetWidth; actPromptEl.classList.add('pop');
});
btnActTimer.addEventListener('click',()=> startTimer(45, btnActTimer));

function startTimer(seconds, btn){
  playClick();
  let t=seconds; btn.disabled=true;
  const fmt = (s)=>`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
  btn.textContent = fmt(t);
  const int = setInterval(()=>{
    t--; btn.textContent=fmt(t); if(t<=0){ clearInterval(int); btn.textContent = fmt(seconds); btn.disabled=false; playEvolve(); }
  },1000);
}

/* ---------- Utils & Sounds ---------- */
function escapeHTML(str){ return String(str).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[s])); }
let audioCtx; function getCtx(){ if(!audioCtx){ const AC=window.AudioContext||window.webkitAudioContext; audioCtx=new AC(); } return audioCtx; }
/* Pixel click (for all Mind buttons) */
function playClick(){
  const ctx=getCtx(); const o=ctx.createOscillator(); const g=ctx.createGain(); const now=ctx.currentTime;
  o.type='square'; o.frequency.setValueAtTime(820, now); o.frequency.exponentialRampToValueAtTime(420, now+0.08);
  g.gain.setValueAtTime(0.18, now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.09);
  o.connect(g).connect(ctx.destination); o.start(now); o.stop(now+0.1);
}
/* EVOLVE sound (magical yet scientific) */
function playEvolve(){
  const ctx=getCtx(); const now=ctx.currentTime;
  function tone(freq,type,gain,dur, detune=0){
    const o=ctx.createOscillator(), g=ctx.createGain();
    o.type=type; o.frequency.setValueAtTime(freq, now); o.detune.setValueAtTime(detune, now);
    g.gain.setValueAtTime(gain, now); g.gain.exponentialRampToValueAtTime(0.0001, now+dur);
    o.connect(g).connect(ctx.destination); o.start(now); o.stop(now+dur);
    return o;
  }
  const a=tone(620,'triangle',0.16,0.28), b=tone(930,'sine',0.10,0.28, +6);
  a.frequency.exponentialRampToValueAtTime(780, now+0.22);
  b.frequency.exponentialRampToValueAtTime(1240, now+0.22);
  tone(1560,'sine',0.06,0.22, -3);
  setTimeout(()=>playClick(),200);
}

/* ---------- Boot ---------- */
showStart();
/* Prepare star rating icons once (for Conspiracy view) */
(function initStars(){
  const starBtns = document.querySelectorAll('.star');
  starBtns.forEach(btn=>{
    btn.innerHTML = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2.2l2.89 5.85 6.46.94-4.67 4.55 1.1 6.43L12 17.77 6.22 19.97l1.1-6.43L2.65 8.99l6.46-.94L12 2.2z"
        fill="none" stroke="#ffd54f" stroke-width="1.6" />
    </svg>`;
  });
})();
</script>
</body>
</html>




