<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mind</title>
<meta name="theme-color" content="#0b0d12" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<!-- Pixel/retro title font -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --fg:#e2e8f0; --muted:#94a3b8; --card:#ffffffdd;
    --accent:#3b82f6; --accent2:#bfdbfe; --accent3:#60a5fa;
    --success1:#10b981; --success2:#34d399;
    --warn1:#f59e0b; --warn2:#fbbf24;
    --hist1:#7dd3fc; --hist2:#a78bfa; --hist3:#f472b6; --hist4:#34d399; --hist5:#fca5a5;
    --bg1:#0b0d12; --bg2:#0e1320;
    --tyrian:#66023C;
    --outline:#FFD700;
    --title-font: "Press Start 2P", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    --body-font:  ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:var(--body-font);color:#fff;background:#0b0d12;overflow:hidden;}

  /* Background + stars */
  .bg{
    position:fixed; inset:0; z-index:-4;
    background:
      radial-gradient(1100px 700px at 15% 20%, color-mix(in oklab, var(--accent) 45%, transparent), transparent 60%),
      radial-gradient(1000px 700px at 85% 30%, color-mix(in oklab, var(--accent2) 45%, transparent), transparent 60%),
      radial-gradient(900px 700px at 40% 90%, color-mix(in oklab, var(--accent3) 35%, transparent), transparent 60%),
      linear-gradient(120deg, var(--bg1), var(--bg2) 50%, var(--bg1));
    animation:bgDrift 20s ease-in-out infinite alternate; filter:saturate(1.05) brightness(1.03);
  }
  @keyframes bgDrift{from{transform:translateX(0)} to{transform:translateX(-1.6%)}}
  #stars{position:fixed; inset:0; pointer-events:none; z-index:-3}

  /* Nav stays above everything else */
  .nav{position:fixed;left:18px;top:18px;display:flex;gap:10px;flex-wrap:wrap;z-index:50}
  .pill{display:inline-block;padding:8px 12px;border-radius:999px;background:#ffffffdd;color:#0a0b0f;font-weight:800;text-decoration:none}

  /* XP bar */
  .xpWrap{position:fixed; right:18px; top:18px; display:flex; align-items:center; gap:12px; max-width:min(520px, 70vw);z-index:50;}
  .xp-badge{background:#ffffffdd;color:#0a0b0f;border-radius:12px;padding:6px 10px;font-size:13px;font-weight:800;box-shadow:0 8px 18px rgba(0,0,0,.15)}
  .xp-bar{flex:1;height:10px;border-radius:999px;background:rgba(255,255,255,.22);overflow:hidden;position:relative;box-shadow:inset 0 2px 6px rgba(0,0,0,.25)}
  .xp-fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));box-shadow:0 6px 20px rgba(13,148,255,.35);transition:width .45s ease}
  .xp-meta{position:fixed;right:18px;top:52px;font-size:12px;color:#cbd5e1;opacity:.9;z-index:50}

  .wrap{height:100%;display:grid;grid-template-rows:auto 1fr;gap:8px;padding:22px}

  /* TITLE — Tyrian purple fill + bright yellow outline */
  .title{
    margin:0;
    font-family:var(--title-font);
    font-weight:900;
    font-size:clamp(36px,9vw,72px);
    line-height:1.08;
    color:var(--tyrian);
    letter-spacing:1px; text-align:center;
    -webkit-text-stroke: 2px var(--outline);
    text-shadow:
      0 0 10px rgba(255,215,0,.25),
      0 10px 28px rgba(0,0,0,.35),
      0 0 28px rgba(102,2,60,.25);
  }

  /* Game/Tools area (pushed down from the title) */
  .game{
    min-height:0;
    display:grid;
    grid-template-rows:auto auto 1fr;
    gap:22px;
    max-width:1100px;
    margin:28px auto 0;
    width:100%;
    padding-top:10px;
  }

  /* START: buttons row + description */
  .start-wrap{display:grid;justify-items:center;gap:14px}
  .start-buttons{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}

  .btn{
    appearance:none;border:none;border-radius:16px;padding:16px 24px;font-weight:900;
    cursor:pointer;transition:transform .08s ease, box-shadow .1s ease, opacity .2s ease
  }
  .btn:active{transform:translateY(1px)}
  .btn-lg{font-size:18px;padding:20px 30px;border-radius:18px}
  .btn-primary{
    color:#0b0d12;
    background:linear-gradient(90deg,var(--accent),var(--accent3));
    box-shadow:0 14px 28px rgba(59,130,246,.38), inset 0 -2px 0 rgba(255,255,255,.25);
  }
  .btn-success{
    color:#052e24;
    background:linear-gradient(90deg,var(--success1),var(--success2));
    box-shadow:0 14px 28px rgba(16,185,129,.38), inset 0 -2px 0 rgba(255,255,255,.25);
  }
  .btn-warn{
    color:#251a00;
    background:linear-gradient(90deg,var(--warn1),var(--warn2));
    box-shadow:0 14px 28px rgba(245,158,11,.38), inset 0 -2px 0 rgba(255,255,255,.25);
  }
  .btn-ghost{background:rgba(255,255,255,.08); color:#e2e8f0; border:1px solid rgba(255,255,255,.16)}

  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:14px}

  .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:4px}
  .spacer{flex:1 1 auto}

  /* Cards */
  .fact-grid{
    display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
    gap:12px;align-content:start;overflow:auto;padding-bottom:8px
  }
  .fact-card{
    --h:210;
    position:relative;
    background:linear-gradient(180deg, hsla(var(--h),80%,60%,.16), hsla(var(--h),80%,40%,.08));
    border:1px solid hsla(var(--h),85%,70%,.35);
    border-radius:14px;padding:10px 12px 12px;backdrop-filter:blur(6px);
    transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .2s ease;
    cursor:pointer;min-height:92px;
    box-shadow:0 6px 18px hsla(var(--h),80%,50%,.18);
  }
  .fact-card:hover{transform:translateY(-2px); box-shadow:0 12px 30px hsla(var(--h),80%,55%,.28); border-color:hsla(var(--h),85%,75%,.55);}
  .fact-title{font-weight:900;margin:0 0 4px 0;color:#fff;font-size:14px}
  .fact-blurb{margin:0;color:#dbe7ff;font-size:12.5px;line-height:1.35;opacity:.95}

  /* Panels */
  .panel{
    position:relative;
    background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);
    border-radius:18px;padding:18px 18px 20px;backdrop-filter:blur(8px);
    display:grid;gap:14px;max-width:860px;justify-self:center;
    box-shadow:0 18px 36px rgba(0,0,0,.25);
    overflow:hidden;
  }
  .panel.glow{ animation:panelGlow 700ms ease-out; }
  @keyframes panelGlow{
    0%{ box-shadow:0 0 0 rgba(102,2,60,.0); border-color:rgba(255,255,255,.14); }
    30%{ box-shadow:0 0 40px rgba(102,2,60,.35), 0 18px 36px rgba(0,0,0,.25); border-color:rgba(255,255,255,.28); }
    100%{ box-shadow:0 18px 36px rgba(0,0,0,.25); border-color:rgba(255,255,255,.14); }
  }
  .ripple{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%) scale(0);
    width:280px; height:280px; border-radius:50%;
    background:radial-gradient(closest-side, rgba(102,2,60,.28), rgba(96,165,250,.22), transparent 70%);
    pointer-events:none; filter:blur(.6px); opacity:.9;
    animation:rippleAnim 700ms ease-out forwards;
  }
  @keyframes rippleAnim{ to{ transform:translate(-50%,-50%) scale(1.6); opacity:0; } }

  .evo-badge{font-size:12px;color:#cbd5e1;opacity:.95}
  .evo-text{font-size:18px;line-height:1.5;margin:0;color:#fff}
  .evo-text.pop{ animation:textPop 160ms ease-out; }
  @keyframes textPop{ 0%{ transform:scale(0.985); filter:blur(.2px); opacity:.96; } 100%{ transform:scale(1); filter:blur(0); opacity:1; } }

  /* Fact checker specifics */
  .fc-textarea{
    width:100%; min-height:96px; resize:vertical;
    border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:rgba(255,255,255,.06); color:#fff; padding:12px 14px;
    font: 600 14px/1.5 var(--body-font); outline:none;
  }
  .badge{display:inline-block; padding:6px 10px; border-radius:999px; font-weight:900; font-size:12px;}
  .badge-true{ background:#22c55e; color:#052e24; }
  .badge-false{ background:#ef4444; color:#2a0909; }
  .badge-unknown{ background:#eab308; color:#1a1400; }

  /* Conspiracy view */
  .ct-title{font-weight:900;margin:0;color:#fff;font-size:18px}
  .ct-text{margin:0;color:#e5ecff;font-size:15px;line-height:1.5}
  .stars{display:flex; gap:6px; align-items:center}
  .star{cursor:pointer; width:28px; height:28px; display:inline-block}
  .star svg{width:100%; height:100%; filter:drop-shadow(0 2px 8px rgba(0,0,0,.25))}
  .rating-hint{font-size:12px;color:#cbd5e1}

  /* History timeline */
  .timeline-wrap{overflow:auto; padding:10px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12)}
  .timeline{display:flex; align-items:center; gap:24px; min-width:720px; padding:16px 12px}
  .t-node{
    --c: var(--hist1);
    position:relative; min-width:160px; max-width:220px; flex:0 0 auto;
    background:linear-gradient(180deg, color-mix(in oklab, var(--c) 35%, transparent), rgba(255,255,255,.06));
    border:1px solid color-mix(in oklab, var(--c) 65%, rgba(255,255,255,.22));
    border-radius:14px; padding:12px; cursor:pointer;
    box-shadow:0 8px 20px color-mix(in oklab, var(--c) 35%, transparent);
    transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
  }
  .t-node:hover{ transform:translateY(-2px); box-shadow:0 16px 32px color-mix(in oklab, var(--c) 50%, transparent); }
  .t-time{font-weight:900; font-size:12px; color:#f1f5f9; opacity:.85}
  .t-title{font-weight:900; font-size:14px; margin:2px 0 4px}
  .t-blurb{font-size:12.5px;color:#eaf2ff;opacity:.95;margin:0}

  .scrolly{overflow:auto;min-height:0}
  .hidden{display:none !important}

  /* ===== Mobile polish ===== */
  @media (max-width: 480px){
    .nav{top:12px;left:12px}
    .xpWrap{top:12px;right:12px}
    .xp-meta{top:46px;right:12px}

    .wrap{padding:96px 14px 18px}
    .title{
      font-size:clamp(28px, 9.5vw, 44px);
      line-height:1.12;
      letter-spacing:.8px;
      -webkit-text-stroke: 1px var(--outline);
      text-shadow:
        0 0 8px rgba(255,215,0,.22),
        0 8px 24px rgba(0,0,0,.35),
        0 0 20px rgba(102,2,60,.20);
    }
    .game{gap:18px; margin-top:22px}
    .btn-lg{font-size:16px;padding:16px 22px}
    .subtitle{font-size:12px}
    .fact-grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
    .fact-card{min-height:88px;padding:10px}
    .evo-text{font-size:16px}
    .t-node{min-width:140px}
  }
</style>
</head>
<body>
  <div class="bg"></div>
  <canvas id="stars"></canvas>

  <div class="nav">
    <a class="pill" href="index.html">← Home</a>
    <a class="pill" href="body.html">Body</a>
    <a class="pill" href="heart.html">Heart</a>
    <a class="pill" href="soul.html">Soul</a>
  </div>

  <div class="xpWrap">
    <div class="xp-badge" id="xpBadge">Level 0</div>
    <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
  </div>
  <div class="xp-meta" id="xpMeta">0 / 200 XP</div>

  <div class="wrap">
    <h1 class="title">Mind</h1>

    <section class="game">
      <!-- START VIEW -->
      <div id="startView" class="start-wrap">
        <div class="start-buttons">
          <button id="btnStartGame" class="btn btn-primary btn-lg" aria-describedby="startDesc">Fact Evolution</button>
          <button id="btnFactChecker" class="btn btn-success btn-lg">Fact checker</button>
          <button id="btnConspiracy" class="btn btn-warn btn-lg">Fun Conspiracy Theories</button>
          <button id="btnHistory" class="btn btn-primary btn-lg">Entire History of the World</button>
        </div>
        <p id="startDesc" class="subtitle">Begin with a fact, then evolve it layer by layer.</p>
      </div>

      <!-- FACT EVOLUTION GRID -->
      <div id="factListView" class="scrolly hidden">
        <div class="fact-grid" id="factGrid"></div>
      </div>

      <!-- FACT EVOLUTION DETAIL -->
      <div id="evoView" class="panel hidden">
        <div class="evo-badge" id="evoMeta"></div>
        <p class="evo-text" id="evoText"></p>
        <div class="actions">
          <button class="btn btn-primary" id="btnDeeper">EVOLVE</button>
          <span class="spacer"></span>
          <button class="btn btn-ghost" id="btnExit">I’m no longer interested</button>
        </div>
      </div>

      <!-- FACT CHECKER -->
      <div id="fcView" class="panel hidden">
        <div class="evo-badge">Fact checker</div>
        <textarea id="fcInput" class="fc-textarea" placeholder="Type a fact, e.g. “The Sahara is the largest hot desert.”"></textarea>
        <div id="fcResultRow" class="actions" style="align-items:center">
          <span id="fcBadge" class="badge badge-unknown hidden">UNKNOWN</span>
          <span id="fcMsg" style="font-size:13px;color:#cbd5e1"></span>
          <span class="spacer"></span>
          <button id="btnFcBack" class="btn btn-ghost">Back</button>
          <button id="btnFcCheck" class="btn btn-success">Check</button>
          <button id="btnFcEvolve" class="btn btn-primary hidden">EVOLVE</button>
        </div>
        <div id="fcExplanation" class="evo-text hidden"></div>
      </div>

      <!-- FUN CONSPIRACY THEORIES -->
      <div id="ctView" class="panel hidden">
        <div class="evo-badge">Fun Conspiracy Theories (for entertainment • rate what you think!)</div>
        <h3 id="ctTitle" class="ct-title"></h3>
        <p id="ctText" class="ct-text"></p>
        <div class="actions" style="align-items:center">
          <div class="stars" aria-label="Rate this theory">
            <span class="rating-hint" id="ctAvg" style="margin-right:6px">—</span>
            <button class="star" data-star="1" aria-label="1 star"></button>
            <button class="star" data-star="2" aria-label="2 stars"></button>
            <button class="star" data-star="3" aria-label="3 stars"></button>
            <button class="star" data-star="4" aria-label="4 stars"></button>
            <button class="star" data-star="5" aria-label="5 stars"></button>
          </div>
          <span class="spacer"></span>
          <button id="btnCtBack" class="btn btn-ghost">Back</button>
          <button id="btnCtAnother" class="btn btn-warn">Another one</button>
        </div>
      </div>

      <!-- ENTIRE HISTORY OF THE WORLD -->
      <div id="histView" class="panel hidden">
        <div class="evo-badge">Entire History of the World — tap a milestone, then EVOLVE for layers</div>
        <div class="timeline-wrap">
          <div class="timeline" id="timeline"></div>
        </div>
        <div id="histDetail" class="hidden">
          <hr style="border-color:rgba(255,255,255,.12);border-width:0 0 1px;margin:8px 0 6px">
          <div class="evo-badge" id="histMeta"></div>
          <p class="evo-text" id="histText"></p>
          <div class="actions">
            <button class="btn btn-primary" id="btnHistEvolve">EVOLVE</button>
            <span class="spacer"></span>
            <button class="btn btn-ghost" id="btnHistBack">Back</button>
          </div>
        </div>
        <div class="actions hidden" id="histBackRow">
          <span class="spacer"></span>
          <button class="btn btn-ghost" id="btnHistClose">Close</button>
        </div>
      </div>
    </section>
  </div>

<script>
/* -------------------- Stars background -------------------- */
const stars=document.getElementById('stars'), sctx=stars.getContext('2d');
function resize(){ stars.width=innerWidth; stars.height=innerHeight; } resize(); addEventListener('resize',resize);
const STARS=Array.from({length:160}).map(()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,z:Math.random()*1.5+.3,dx:(Math.random()-.5)*0.15,dy:(Math.random()-.5)*0.15}));
(function draw(){ requestAnimationFrame(draw); sctx.clearRect(0,0,stars.width,stars.height);
  STARS.forEach(s=>{ s.x+=s.dx*s.z; s.y+=s.dy*s.z;
    if(s.x<0)s.x+=stars.width; if(s.x>stars.width)s.x-=stars.width; if(s.y<0)s.y+=stars.height; if(s.y>stars.height)s.y-=stars.height;
    sctx.fillStyle=`rgba(255,255,255,${0.25*s.z})`; sctx.fillRect(s.x,s.y,1.2*s.z,1.2*s.z); }); })();

/* -------------------- XP (unchanged) -------------------- */
function loadXP(){ try{ return JSON.parse(localStorage.getItem("xp_v1")) || {level:0, xp:0}; } catch { return {level:0, xp:0}; } }
const MAX_LEVEL=100; function xpForNext(level){ if(level>=MAX_LEVEL)return Infinity; const base=200,growth=1.12; return Math.round(base*Math.pow(growth,level)); }
function updateXPUI(){ const xp=loadXP(); const need=xpForNext(xp.level);
  document.getElementById('xpBadge').textContent=`Level ${xp.level}`;
  document.getElementById('xpFill').style.width=(xp.level>=MAX_LEVEL?100:Math.round(100*(xp.xp/need)))+"%";
  document.getElementById('xpMeta').textContent=xp.level>=MAX_LEVEL?`MAX • Level ${MAX_LEVEL}`:`${xp.xp} / ${need} XP`;
}
updateXPUI(); document.addEventListener('visibilitychange',()=>{ if(!document.hidden) updateXPUI(); });

/* ============================================================
   FACT EVOLUTION (unchanged core)
   ============================================================ */
const FACTS = [
  {id:"sahara",title:"Sahara Desert",layers:[
    "The Sahara is the largest hot desert on Earth.",
    "It spans about 9 million km² across North Africa.",
    "Average rainfall is typically under 100 mm per year.",
    "Day–night swings can reach from ~50°C to near freezing."]},
  {id:"light",title:"Speed of Light",layers:[
    "Light in vacuum travels at a constant speed.",
    "That constant is ~299,792 km per second.",
    "It’s commonly rounded to 3×10⁵ km/s for simplicity.",
    "This limit shapes causality in modern physics."]},
  {id:"honey",title:"Honey & Spoilage",layers:[
    "Honey can last a very long time.",
    "Its low water activity inhibits microbial growth.",
    "Acidity (~pH 3–4.5) and hydrogen peroxide help preservation.",
    "Archaeologists have found edible honey in ancient tombs."]}
];

const startViewEl=document.getElementById('startView');
const btnStartGame=document.getElementById('btnStartGame');
const btnFactChecker=document.getElementById('btnFactChecker');
const btnConspiracy=document.getElementById('btnConspiracy');
const btnHistory=document.getElementById('btnHistory');

const factGridEl=document.getElementById('factGrid');
const listViewEl=document.getElementById('factListView');
const evoViewEl=document.getElementById('evoView');
const evoMetaEl=document.getElementById('evoMeta');
const evoTextEl=document.getElementById('evoText');
const btnDeeper=document.getElementById('btnDeeper');
const btnExit=document.getElementById('btnExit');

/* Fact checker elements */
const fcViewEl=document.getElementById('fcView');
const fcInputEl=document.getElementById('fcInput');
const fcBadgeEl=document.getElementById('fcBadge');
const fcMsgEl=document.getElementById('fcMsg');
const fcExplainEl=document.getElementById('fcExplanation');
const btnFcBack=document.getElementById('btnFcBack');
const btnFcCheck=document.getElementById('btnFcCheck');
const btnFcEvolve=document.getElementById('btnFcEvolve');

/* Conspiracy elements */
const ctViewEl=document.getElementById('ctView');
const ctTitleEl=document.getElementById('ctTitle');
const ctTextEl=document.getElementById('ctText');
const btnCtBack=document.getElementById('btnCtBack');
const btnCtAnother=document.getElementById('btnCtAnother');
const ctAvgEl=document.getElementById('ctAvg');

/* History elements */
const histViewEl=document.getElementById('histView');
const timelineEl=document.getElementById('timeline');
const histDetailEl=document.getElementById('histDetail');
const histMetaEl=document.getElementById('histMeta');
const histTextEl=document.getElementById('histText');
const btnHistEvolve=document.getElementById('btnHistEvolve');
const btnHistBack=document.getElementById('btnHistBack');
const btnHistClose=document.getElementById('btnHistClose');
const histBackRowEl=document.getElementById('histBackRow');

let currentFact=null, layerIndex=0;

/* -------------------- Views -------------------- */
function hideAll(){
  startViewEl.classList.add('hidden');
  listViewEl.classList.add('hidden');
  evoViewEl.classList.add('hidden');
  fcViewEl.classList.add('hidden');
  ctViewEl.classList.add('hidden');
  histViewEl.classList.add('hidden');
}
function showStart(){ hideAll(); startViewEl.classList.remove('hidden'); currentFact=null; layerIndex=0; }
function showList(){ hideAll(); listViewEl.classList.remove('hidden'); }
function showEvo(){ hideAll(); evoViewEl.classList.remove('hidden'); }
function showFc(){ hideAll(); fcViewEl.classList.remove('hidden'); }
function showCt(){ hideAll(); ctViewEl.classList.remove('hidden'); }
function showHist(){ hideAll(); histViewEl.classList.remove('hidden'); }

/* -------------------- Renderers -------------------- */
function renderFactGrid(){
  factGridEl.innerHTML='';
  const hues=[200,265,150,15,330,185,95,40,280,125,355,210];
  FACTS.forEach((f,i)=>{
    const h=hues[i%hues.length];
    const card=document.createElement('button');
    card.className='fact-card';
    card.style.setProperty('--h',h);
    card.innerHTML=`<div class="fact-title">${escapeHTML(f.title)}</div><p class="fact-blurb">${escapeHTML(f.layers[0])}</p>`;
    card.addEventListener('click',()=>{ playClick(); beginEvolution(f.id); });
    factGridEl.appendChild(card);
  });
}
function beginEvolution(fid){
  currentFact=FACTS.find(x=>x.id===fid);
  layerIndex=0;
  updateEvoPanel();
  showEvo();
}
function updateEvoPanel(){
  const total=currentFact.layers.length;
  evoTextEl.textContent=currentFact.layers[layerIndex];
  evoMetaEl.textContent=`Layer ${layerIndex+1} of ${total} • ${currentFact.title}`;
  btnDeeper.disabled=(layerIndex>=total-1);
  btnDeeper.style.opacity=(layerIndex>=total-1?0.6:1);
}

/* -------------------- Button interactions -------------------- */
btnStartGame.addEventListener('click',()=>{ playClick(); renderFactGrid(); showList(); });
btnFactChecker.addEventListener('click',()=>{ playClick(); resetFactChecker(); showFc(); });
btnConspiracy.addEventListener('click',()=>{ playClick(); showRandomTheory(); showCt(); setupStars(); });
btnHistory.addEventListener('click',()=>{ playClick(); renderTimeline(); showHist(); });

btnDeeper.addEventListener('click',()=>{
  if(!currentFact) return;
  if(layerIndex < currentFact.layers.length-1){
    layerIndex++;
    updateEvoPanel();
    playEvolve();
    evoTextEl.classList.remove('pop'); void evoTextEl.offsetWidth; evoTextEl.classList.add('pop');
    evoViewEl.classList.remove('glow'); void evoViewEl.offsetWidth; evoViewEl.classList.add('glow');
    const r=document.createElement('span'); r.className='ripple'; evoViewEl.appendChild(r);
    r.addEventListener('animationend', ()=> r.remove(), {once:true});
  }else{
    playClick();
    evoViewEl.classList.remove('glow'); void evoViewEl.offsetWidth; evoViewEl.classList.add('glow');
  }
});
btnExit.addEventListener('click',()=>{ playClick(); showStart(); });

/* -------------------- Fact checker logic -------------------- */
function resetFactChecker(){
  fcInputEl.value='';
  fcBadgeEl.className='badge badge-unknown hidden'; fcBadgeEl.textContent='UNKNOWN';
  fcMsgEl.textContent=''; fcExplainEl.textContent=''; fcExplainEl.classList.add('hidden');
  btnFcEvolve.classList.add('hidden');
}
btnFcBack.addEventListener('click',()=>{ playClick(); showStart(); });
btnFcCheck.addEventListener('click',()=>{
  playClick();
  const text=fcInputEl.value.trim();
  if(!text){ fcMsgEl.textContent='Type a fact to check.'; fcBadgeEl.classList.add('hidden'); return; }
  const { verdict, message, explanation } = localHeuristicCheck(text);
  fcBadgeEl.classList.remove('hidden');
  fcBadgeEl.textContent = verdict.toUpperCase();
  fcBadgeEl.className = 'badge ' + (verdict==='true' ? 'badge-true' : verdict==='false' ? 'badge-false' : 'badge-unknown');
  fcMsgEl.textContent = message;
  btnFcEvolve.classList.remove('hidden');
  btnFcEvolve.onclick = ()=>{ playEvolve(); fcExplainEl.textContent = explanation; fcExplainEl.classList.remove('hidden'); fcExplainEl.classList.remove('pop'); void fcExplainEl.offsetWidth; fcExplainEl.classList.add('pop'); fcViewEl.classList.remove('glow'); void fcViewEl.offsetWidth; fcViewEl.classList.add('glow'); };
});
function localHeuristicCheck(text){
  const t=text.toLowerCase();
  if(/sahara .*largest .*hot desert/.test(t)) return {verdict:'true', message:'Matches established geography references.', explanation:'The Sahara covers ~9 million km² across North Africa, the largest hot desert by area. Cold deserts like Antarctica are larger overall, but not “hot deserts.”'};
  if(/earth .* flat/.test(t)) return {verdict:'false', message:'Contradicted by geophysical evidence.', explanation:'Satellite imagery, circumnavigation, and gravitational measurements confirm Earth’s spheroidal shape. Eclipses, horizon behavior, and GPS orbits also contradict a flat model.'};
  if(/honey .* (never .* spoil|lasts forever)/.test(t)) return {verdict:'true', message:'Generally true with caveats.', explanation:'Honey’s low water activity, acidity, and antimicrobial compounds inhibit spoilage. Sealed properly, it remains edible for very long periods despite crystallization.'};
  return {verdict:'unknown', message:'Needs verification — ambiguous, time-bound, or too broad.', explanation:'Specify names, dates, units, and scope. Reliable verification typically needs a cited source and disambiguation of terms.'};
}

/* -------------------- Fun Conspiracy Theories -------------------- */
/* Lighthearted entries only; purely for entertainment */
const THEORIES = [
  {id:'bielefeld', title:'The Bielefeld Conspiracy', text:'A long-running German in-joke claims the city of Bielefeld doesn’t exist. Anyone who says they’ve been there is “part of the cover-up.”'},
  {id:'birds', title:'Birds Aren’t Real (satire)', text:'A tongue-in-cheek movement that jokes birds were replaced by surveillance drones. It’s satire about modern misinformation.'},
  {id:'mandela', title:'The Mandela Effect', text:'Large groups “remember” things differently (movie lines, brand spellings). The fun theory: parallel timelines. The sober view: memory is glitchy.'},
  {id:'wow', title:'The “Wow!” Signal', text:'In 1977 a strong narrowband radio signal was detected once and never repeated. Some wonder if it was alien — others say unknown natural/technical origin.'},
  {id:'oak', title:'Oak Island Mystery', text:'Stories of a hidden pit and booby-trapped tunnels in Nova Scotia promise buried treasure. Digs found curiosities, but the vault remains elusive…'},
  {id:'shakespeare', title:'Who Wrote Shakespeare?', text:'A minority suspects alternate authors (Oxford, Marlowe, Bacon). Mainstream scholars attribute the works to Shakespeare of Stratford.'}
];
const CT_RATINGS_KEY='ct_ratings_v1'; // { [id]: {count, sum} }
function loadRatings(){ try{ return JSON.parse(localStorage.getItem(CT_RATINGS_KEY))||{} } catch{ return {} } }
function saveRatings(r){ localStorage.setItem(CT_RATINGS_KEY, JSON.stringify(r)); }
let currentTheory=null;

function showRandomTheory(){
  const pick = THEORIES[Math.floor(Math.random()*THEORIES.length)];
  currentTheory = pick;
  ctTitleEl.textContent = pick.title;
  ctTextEl.textContent  = pick.text;
  updateCtAverageUI();
}
btnCtAnother.addEventListener('click',()=>{ playClick(); showRandomTheory(); ctViewEl.classList.remove('glow'); void ctViewEl.offsetWidth; ctViewEl.classList.add('glow'); });
btnCtBack.addEventListener('click',()=>{ playClick(); showStart(); });

function setupStars(){
  const starBtns = ctViewEl.querySelectorAll('.star');
  starBtns.forEach(btn=>{
    btn.innerHTML = starSVG(false);
    btn.onmouseenter = ()=> highlightStars(+btn.dataset.star);
    btn.onmouseleave = ()=> highlightStars(0);
    btn.onclick = ()=> { playClick(); rateTheory(+btn.dataset.star); };
  });
  highlightStars(0);
}
function starSVG(filled){
  return `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.2l2.89 5.85 6.46.94-4.67 4.55 1.1 6.43L12 17.77 6.22 19.97l1.1-6.43L2.65 8.99l6.46-.94L12 2.2z" ${filled? 'fill="#ffd54f"':'fill="none"'} stroke="#ffd54f" stroke-width="1.6" /></svg>`;
}
function highlightStars(n){
  const starBtns = ctViewEl.querySelectorAll('.star');
  starBtns.forEach((btn,idx)=>{ btn.innerHTML = starSVG(idx < n); });
}
function rateTheory(stars){
  if(!currentTheory) return;
  const r=loadRatings();
  const rec=r[currentTheory.id]||{count:0,sum:0};
  rec.count++; rec.sum += stars;
  r[currentTheory.id]=rec; saveRatings(r);
  updateCtAverageUI();
}
function updateCtAverageUI(){
  const r=loadRatings(); const rec=r[currentTheory.id]||{count:0,sum:0};
  const avg = rec.count? (rec.sum/rec.count) : 0;
  ctAvgEl.textContent = rec.count? `Avg ${avg.toFixed(1)}★ • ${rec.count} rating${rec.count>1?'s':''}` : 'No ratings yet';
}

/* -------------------- Entire History of the World -------------------- */
const EVENTS = [
  { id:'bigbang',  color:'var(--hist1)', time:'~13.8 Ga', title:'Big Bang', blurb:'Universe begins expanding from a hot dense state.', layers:[
    'Cosmic microwave background is leftover radiation from the early universe.',
    'Hydrogen & helium formed within minutes; stars later forged heavier elements.',
    'Large-scale structure (filaments/voids) emerged via gravity from tiny fluctuations.'
  ]},
  { id:'solarsys', color:'var(--hist2)', time:'~4.6 Ga', title:'Solar System Forms', blurb:'Sun ignites; planets accrete from a rotating disk.', layers:[
    'Rocky planets formed inside the frost line; gas giants formed beyond it.',
    'Late heavy bombardment pockmarked early surfaces with craters.',
    'Earth’s Moon likely formed after a giant impact (Theia hypothesis).'
  ]},
  { id:'firstlife', color:'var(--hist3)', time:'≥3.5 Ga', title:'Earliest Life', blurb:'Microbial life appears in ancient oceans.', layers:[
    'Stromatolites record layered microbial mats.',
    'Life likely used chemical energy near hydrothermal vents or shallow chemistries.',
    'Photosynthesis oxygenated the atmosphere (Great Oxidation Event).'
  ]},
  { id:'cambrian', color:'var(--hist4)', time:'~541 Ma', title:'Cambrian Explosion', blurb:'Rapid diversification of animal body plans.', layers:[
    'Fossils like trilobites and anomalocaridids abound.',
    'Ecological arms races (predator–prey) accelerated evolution.',
    'Most major phyla appear in the fossil record.'
  ]},
  { id:'dinos', color:'var(--hist5)', time:'252–66 Ma', title:'Age of Dinosaurs', blurb:'Mesozoic Era: dinosaurs dominate land ecosystems.', layers:[
    'Pangaea split; climates and ecosystems diversified.',
    'Birds evolved from theropod dinosaurs.',
    'Flowering plants spread in the Cretaceous.'
  ]},
  { id:'kpg', color:'var(--hist1)', time:'66 Ma', title:'K–Pg Extinction', blurb:'Asteroid impact + aftereffects end non-avian dinosaurs.', layers:[
    'Chicxulub impact threw dust/aerosols into the atmosphere.',
    'Food chains collapsed; many species went extinct.',
    'Mammals diversified in the aftermath.'
  ]},
  { id:'humans', color:'var(--hist2)', time:'~300 ka', title:'Homo sapiens', blurb:'Anatomically modern humans arise in Africa.', layers:[
    'Cultural innovation (tools, art, language) accelerates.',
    'Migrations out of Africa populate the globe.',
    'Interbreeding with Neanderthals/Denisovans left genetic traces.'
  ]},
  { id:'ancient', color:'var(--hist3)', time:'~3000–500 BCE', title:'Ancient Civilizations', blurb:'Sumer, Egypt, Indus, China, Mesoamerica…', layers:[
    'Writing, cities, states, and long-distance trade networks.',
    'Monumental architecture and codified laws.',
    'Mathematics, astronomy, and calendars develop.'
  ]},
  { id:'middle', color:'var(--hist4)', time:'~500–1500 CE', title:'“Dark Ages”/Middle Ages', blurb:'Term “Dark Ages” is debated; knowledge persisted and grew.', layers:[
    'Byzantine, Islamic Golden Age, and others preserved/advanced science.',
    'Universities emerged; agricultural and mechanical innovations spread.',
    'Gothic architecture, scholasticism, and cross-cultural exchange.'
  ]},
  { id:'renaissance', color:'var(--hist5)', time:'~1300–1600', title:'Renaissance', blurb:'Revival in arts, science, and humanism in Europe.', layers:[
    'Printing press accelerates knowledge sharing.',
    'Copernican heliocentrism challenges geocentrism.',
    'Exploration connects continents (with profound consequences).'
  ]},
  { id:'industrial', color:'var(--hist1)', time:'~1760–1900', title:'Industrial Revolution', blurb:'Mechanization, steam power, and factories.', layers:[
    'Rapid urbanization and new social/economic structures.',
    'Railroads and telegraphs compress time and distance.',
    'Public health, labor, and environmental challenges arise.'
  ]},
  { id:'space', color:'var(--hist2)', time:'~1957–', title:'Space Age', blurb:'Satellites, Moon landings, planetary probes.', layers:[
    'Global communications and navigation (GPS).',
    'Robotic explorers map the solar system.',
    'Space telescopes reveal the distant universe.'
  ]},
  { id:'digital', color:'var(--hist3)', time:'~1970–today', title:'Digital Era', blurb:'Computing, internet, AI reshape society.', layers:[
    'Information abundance and connectivity.',
    'Automation, data, and new industries.',
    'Privacy, ethics, and access remain central debates.'
  ]}
];

function renderTimeline(){
  timelineEl.innerHTML='';
  EVENTS.forEach((e, idx)=>{
    const node=document.createElement('button');
    node.className='t-node';
    node.style.setProperty('--c', e.color);
    node.innerHTML=`
      <div class="t-time">${escapeHTML(e.time)}</div>
      <div class="t-title">${escapeHTML(e.title)}</div>
      <p class="t-blurb">${escapeHTML(e.blurb)}</p>`;
    node.addEventListener('click',()=>{ playClick(); openHistDetail(e.id); });
    timelineEl.appendChild(node);
  });
  histDetailEl.classList.add('hidden');
  histBackRowEl.classList.remove('hidden');
}
let currEvent=null, histLayer=0;
function openHistDetail(id){
  currEvent = EVENTS.find(x=>x.id===id);
  histLayer=0; updateHistPanel(); histDetailEl.classList.remove('hidden');
}
function updateHistPanel(){
  const total=currEvent.layers.length;
  histTextEl.textContent = currEvent.layers[histLayer];
  histMetaEl.textContent = `Layer ${histLayer+1} of ${total} • ${currEvent.title}`;
  btnHistEvolve.disabled = (histLayer>=total-1);
  btnHistEvolve.style.opacity = (histLayer>=total-1?0.6:1);
}
btnHistEvolve.addEventListener('click',()=>{
  if(!currEvent) return;
  if(histLayer < currEvent.layers.length-1){
    histLayer++;
    updateHistPanel();
    playEvolve();
    histTextEl.classList.remove('pop'); void histTextEl.offsetWidth; histTextEl.classList.add('pop');
    histViewEl.classList.remove('glow'); void histViewEl.offsetWidth; histViewEl.classList.add('glow');
    const r=document.createElement('span'); r.className='ripple'; histViewEl.appendChild(r); r.addEventListener('animationend',()=>r.remove(),{once:true});
  }else{
    playClick();
  }
});
btnHistBack.addEventListener('click',()=>{ playClick(); histDetailEl.classList.add('hidden'); });
btnHistClose.addEventListener('click',()=>{ playClick(); showStart(); });

/* -------------------- Sounds (Web Audio) -------------------- */
let audioCtx;
function getCtx(){ if(!audioCtx){ const AC=window.AudioContext||window.webkitAudioContext; audioCtx=new AC(); } return audioCtx; }
function playClick(){
  const ctx=getCtx(); const o=ctx.createOscillator(); const g=ctx.createGain(); const now=ctx.currentTime;
  o.type='square'; o.frequency.setValueAtTime(800, now); o.frequency.exponentialRampToValueAtTime(420, now+0.08);
  g.gain.setValueAtTime(0.18, now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.09);
  o.connect(g).connect(ctx.destination); o.start(now); o.stop(now+0.1);
}
function playEvolve(){
  const ctx=getCtx(); const now=ctx.currentTime;
  function tone(freq,type,gain,dur){ const o=ctx.createOscillator(), g=ctx.createGain(); o.type=type; o.frequency.setValueAtTime(freq,now); g.gain.setValueAtTime(gain,now); g.gain.exponentialRampToValueAtTime(0.0001,now+dur); o.connect(g).connect(ctx.destination); o.start(now); o.stop(now+dur); return o; }
  const o1=tone(620,'triangle',0.16,0.28), o2=tone(930,'sine',0.10,0.28); o1.frequency.exponentialRampToValueAtTime(780, now+0.22); o2.frequency.exponentialRampToValueAtTime(1240, now+0.22);
  tone(1560,'sine',0.06,0.22); setTimeout(()=>playClick(),200);
}

/* -------------------- Utils -------------------- */
function escapeHTML(str){ return String(str).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[s])); }

/* Boot */
showStart();

/* Build star buttons once */
(function initStars(){
  const starBtns = document.querySelectorAll('.star');
  starBtns.forEach(btn=>{ btn.innerHTML = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.2l2.89 5.85 6.46.94-4.67 4.55 1.1 6.43L12 17.77 6.22 19.97l1.1-6.43L2.65 8.99l6.46-.94L12 2.2z" fill="none" stroke="#ffd54f" stroke-width="1.6" /></svg>`; });
})();
</script>
</body>
</html>


